/*! Flocking 0.2.0, Copyright 2017 Colin Clark | flockingjs.org */

"use strict";!function(){var a="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof module&&module.exports?module.exports:global;if(!a.ArrayMath){var b={};b.add=function(a,b,c){var d;if(b instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]+c[d];else for(d=Math.min(a.length,c.length)-1;d>=0;--d)a[d]=b+c[d]},b.sub=function(a,b,c){var d;if(b instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]-c[d];else for(d=Math.min(a.length,c.length)-1;d>=0;--d)a[d]=b-c[d]},b.mul=function(a,b,c){var d;if(b instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]*c[d];else for(d=Math.min(a.length,c.length)-1;d>=0;--d)a[d]=b*c[d]},b.mulCplx=function(a,b,c,d,e,f){var g,h,i,j,k;if(c instanceof Float32Array)for(g=Math.min(a.length,b.length,c.length,d.length,e.length,f.length)-1;g>=0;--g)h=c[g],i=d[g],j=e[g],k=f[g],a[g]=h*j-i*k,b[g]=h*k+i*j;else for(g=Math.min(a.length,b.length,e.length,f.length)-1;g>=0;--g)j=e[g],k=f[g],a[g]=c*j-d*k,b[g]=c*k+d*j},b.div=function(a,b,c){var d;if(b instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]/c[d];else for(d=Math.min(a.length,c.length)-1;d>=0;--d)a[d]=b/c[d]},b.divCplx=function(a,b,c,d,e,f){var g,h,i,j,k,l;if(c instanceof Float32Array)for(g=Math.min(a.length,b.length,c.length,d.length,e.length,f.length)-1;g>=0;--g)h=c[g],i=d[g],j=e[g],k=f[g],l=1/(j*j+k*k),a[g]=(h*j+i*k)*l,b[g]=(i*j-h*k)*l;else for(g=Math.min(a.length,b.length,e.length,f.length)-1;g>=0;--g)j=e[g],k=f[g],l=1/(j*j+k*k),a[g]=(c*j+d*k)*l,b[g]=(d*j-c*k)*l},b.madd=function(a,b,c,d){var e;if(b instanceof Float32Array)for(e=Math.min(a.length,b.length,c.length,d.length)-1;e>=0;--e)a[e]=b[e]*c[e]+d[e];else for(e=Math.min(a.length,c.length,d.length)-1;e>=0;--e)a[e]=b*c[e]+d[e]},b.abs=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.abs(b[c])},b.absCplx=function(a,b,c){for(var d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=Math.sqrt(b[d]*b[d]+c[d]*c[d])},b.acos=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.acos(b[c])},b.asin=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.asin(b[c])},b.atan=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.atan(b[c])},b.atan2=function(a,b,c){for(var d=Math.min(a.length,c.length,b.length)-1;d>=0;--d)a[d]=Math.atan2(b[d],c[d])},b.ceil=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.ceil(b[c])},b.cos=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.cos(b[c])},b.exp=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.exp(b[c])},b.floor=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.floor(b[c])},b.log=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.log(b[c])},b.max=function(a){for(var b=-(1/0),c=a.length-1;c>=0;--c){var d=a[c];d>b&&(b=d)}return b},b.min=function(a){for(var b=1/0,c=a.length-1;c>=0;--c){var d=a[c];b>d&&(b=d)}return b},b.pow=function(a,b,c){var d;if(c instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=Math.pow(b[d],c[d]);else for(d=Math.min(a.length,b.length)-1;d>=0;--d)a[d]=Math.pow(b[d],c)},b.random=function(a,b,c){b||(b=0),isNaN(parseFloat(c))&&(c=1);for(var d=c-b,e=a.length-1;e>=0;--e)a[e]=Math.random()*d+b},b.round=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.round(b[c])},b.sin=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.sin(b[c])},b.sqrt=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.sqrt(b[c])},b.tan=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.tan(b[c])},b.clamp=function(a,b,c,d){for(var e=Math.min(a.length,b.length)-1;e>=0;--e){var f=b[e];a[e]=c>f?c:f>d?d:f}},b.fract=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c){var d=b[c];a[c]=d-Math.floor(d)}},b.fill=function(a,b){for(var c=a.length-1;c>=0;--c)a[c]=b},b.ramp=function(a,b,c){var d=a.length-1;if(d>=0&&(a[0]=b),d>0)for(var e=(c-b)/d,f=1;d>=f;++f)a[f]=b+e*f},b.sign=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=b[c]<0?-1:1},b.sum=function(a){for(var b=0,c=a.length-1;c>=0;--c)b+=a[c];return b},b.sampleLinear=function(a,b,c){for(var d=b.length,e=d-1,f=Math.min(a.length,c.length)-1;f>=0;--f){var g=c[f];g=0>g?0:g>e?e:g;var h=Math.floor(g),i=g-h,j=b[h],k=b[e>h?h+1:e];a[f]=j+i*(k-j)}},b.sampleLinearRepeat=function(a,b,c){for(var d=b.length,e=d-1,f=Math.min(a.length,c.length)-1;f>=0;--f){var g=c[f];g-=Math.floor(g/d)*d;var h=Math.floor(g),i=g-h,j=b[h],k=b[e>h?h+1:0];a[f]=j+i*(k-j)}},b.sampleCubic=function(a,b,c){for(var d=b.length,e=d-1,f=Math.min(a.length,c.length)-1;f>=0;--f){var g=c[f];g=0>g?0:g>e?e:g;var h=Math.floor(g),i=g-h,j=i*i,k=j*i,l=-2*k+3*j,m=1-l,n=k-j,o=n-j+i,p=b[h>0?h-1:0],q=b[h],r=b[e>h?h+1:e],s=b[e-1>h?h+2:e];a[f]=m*q+l*r+.5*(o*(r-p)+n*(s-q))}},b.sampleCubicRepeat=function(a,b,c){for(var d=b.length,e=d-1,f=Math.min(a.length,c.length)-1;f>=0;--f){var g=c[f];g-=Math.floor(g/d)*d;var h=Math.floor(g),i=g-h,j=i*i,k=j*i,l=-2*k+3*j,m=1-l,n=k-j,o=n-j+i,p=b[h>0?h-1:e],q=b[h],r=b[e>h?h+1:0],s=b[e-1>h?h+2:h+2-Math.floor((h+2)/d)*d];a[f]=m*q+l*r+.5*(o*(r-p)+n*(s-q))}},b.pack=function(a,b,c,d,e,f,g){var h=Math.floor(Math.max(0,a.length-b)/c),i=Math.min(h,d.length);if(e){var i=Math.min(i,e.length);if(f){var i=Math.min(i,f.length);if(g)for(var i=Math.min(i,g.length),j=0;i>j;++j)a[b]=d[j],a[b+1]=e[j],a[b+2]=f[j],a[b+3]=g[j],b+=c;else for(var j=0;i>j;++j)a[b]=d[j],a[b+1]=e[j],a[b+2]=f[j],b+=c}else for(var j=0;i>j;++j)a[b]=d[j],a[b+1]=e[j],b+=c}else for(var j=0;i>j;++j)a[b]=d[j],b+=c},b.unpack=function(a,b,c,d,e,f,g){var h=Math.floor(Math.max(0,a.length-b)/c),i=Math.min(h,d.length);if(e){var i=Math.min(i,e.length);if(f){var i=Math.min(i,f.length);if(g)for(var i=Math.min(i,g.length),j=0;i>j;++j)d[j]=a[b],e[j]=a[b+1],f[j]=a[b+2],g[j]=a[b+3],b+=c;else for(var j=0;i>j;++j)d[j]=a[b],e[j]=a[b+1],f[j]=a[b+2],b+=c}else for(var j=0;i>j;++j)d[j]=a[b],e[j]=a[b+1],b+=c}else for(var j=0;i>j;++j)d[j]=a[b],b+=c},a.ArrayMath=b}}(),function(){var a="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof module&&module.exports?module.exports:global;if(!a.Filter){var b=function(a,b){(isNaN(parseFloat(a))||!isFinite(a))&&(a=1),b||(b=0),this._b=new Float32Array(a),this._b[0]=1,this._a=new Float32Array(b),this._bHist=new Float32Array(a),this._aHist=new Float32Array(b)};b.prototype.filter=function(a,b){var c,d=this._a,e=d.length,f=this._b,g=f.length,h=this._aHist,i=this._bHist,j=b.length,k=a.length,l=g-1,m=e;for(c=0;(l||m)&&j>c;++c){var n,o;o=g-l,l&&l--;var p=f[0]*b[c];for(n=1;o>n;++n)p+=f[n]*b[c-n];for(;g>n;++n)p+=f[n]*i[n-o];for(o=e-m,m&&m--,n=0;o>n;++n)p-=d[n]*a[c-1-n];for(;e>n;++n)p-=d[n]*h[n-o];a[c]=p}if(3==g&&2==e)for(var q,r,s=f[0],t=f[1],u=f[2],v=d[0],w=d[1],x=b[c-1],y=b[c-2],z=a[c-1],A=a[c-2];j>c;++c)q=y,y=x,x=b[c],r=A,A=z,z=s*x+t*y+u*q-v*A-w*r,a[c]=z;else for(;j>c;++c){var n,p=f[0]*b[c];for(n=1;g>n;++n)p+=f[n]*b[c-n];for(n=0;e>n;++n)p-=d[n]*a[c-1-n];a[c]=p}var B=Math.min(g-1,j);for(c=g-2;c>=B;--c)i[c]=i[c-B];for(c=0;B>c;++c)i[c]=b[j-1-c];for(B=Math.min(e,k),c=e-1;c>=B;--c)h[c]=h[c-B];for(c=0;B>c;++c)h[c]=a[j-1-c]},b.prototype.clearHistory=function(){for(var a=this._bHist.length-1;a>=0;--a)this._bHist[a]=0;for(var a=this._aHist.length-1;a>=0;--a)this._aHist[a]=0},b.prototype.setB=function(a){for(var b=Math.min(this._b.length,a.length),c=0;b>c;++c)this._b[c]=a[c]},b.prototype.setA=function(a){for(var b=Math.min(this._a.length,a.length),c=0;b>c;++c)this._a[c]=a[c]},a.Filter=b}}(),function(){var a="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof module&&module.exports?module.exports:global;if(!a.FFT){var b=function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o,p=0,q=c,r=c+g,s=.7071067811865475,t=q+g;t>q;)j=a[q]*s,k=b[q]*s,l=a[r]*s,m=b[r]*s,n=e[p],o=f[p],h=l*n-m*o,i=l*o+m*n,a[r]=j-h,b[r]=k-i,a[q]=j+h,b[q]=k+i,p+=d,++q,++r},c=function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=0,y=0,z=2*d,A=c,B=c+g,C=c+2*g,D=f[d*g],E=.5773502691896258,F=A+g;F>A;)p=a[A]*E,q=b[A]*E,r=a[B]*E,s=b[B]*E,t=a[C]*E,u=b[C]*E,v=e[x],w=f[x],j=r*v-s*w,k=r*w+s*v,v=e[y],w=f[y],l=t*v-u*w,m=t*w+u*v,n=j+l,o=k+m,h=j-l,i=k-m,r=p-.5*n,s=q-.5*o,h*=D,i*=D,a[A]=p+n,b[A]=q+o,a[C]=r+i,b[C]=s-h,a[B]=r-i,b[B]=s+h,x+=d,y+=z,++A,++B,++C},d=function(a,b,c,d,e,f,g,h){for(var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=0,F=0,G=0,H=2*d,I=3*d,J=c,K=c+g,L=c+2*g,M=c+3*g,N=.5,O=J+g;O>J;)u=a[J]*N,v=b[J]*N,w=a[K]*N,x=b[K]*N,y=a[L]*N,z=b[L]*N,A=a[M]*N,B=b[M]*N,C=e[E],D=f[E],i=w*C-x*D,j=w*D+x*C,C=e[F],D=f[F],k=y*C-z*D,l=y*D+z*C,C=e[G],D=f[G],m=A*C-B*D,n=A*D+B*C,s=u-k,t=v-l,u+=k,v+=l,o=i+m,p=j+n,q=i-m,r=j-n,a[L]=u-o,b[L]=v-p,a[J]=u+o,b[J]=v+p,h?(a[K]=s-r,b[K]=t+q,a[M]=s+r,b[M]=t-q):(a[K]=s+r,b[K]=t-q,a[M]=s-r,b[M]=t+q),E+=d,F+=H,G+=I,++J,++K,++L,++M},e=function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=0,U=0,V=0,W=0,X=2*d,Y=3*d,Z=4*d,$=c,_=c+g,aa=c+2*g,ba=c+3*g,ca=c+4*g,da=e[d*g],ea=f[d*g],fa=e[2*d*g],ga=f[2*d*g],ha=.4472135954999579,ia=$+g;ia>$;)H=a[$]*ha,I=b[$]*ha,J=a[_]*ha,K=b[_]*ha,L=a[aa]*ha,M=b[aa]*ha,N=a[ba]*ha,O=b[ba]*ha,P=a[ca]*ha,Q=b[ca]*ha,h=H,i=I,R=e[T],S=f[T],j=J*R-K*S,k=J*S+K*R,R=e[U],S=f[U],l=L*R-M*S,m=L*S+M*R,R=e[V],S=f[V],n=N*R-O*S,o=N*S+O*R,R=e[W],S=f[W],p=P*R-Q*S,q=P*S+Q*R,v=j+p,w=k+q,B=j-p,C=k-q,x=l+n,y=m+o,z=l-n,A=m-o,a[$]=H+v+x,b[$]=I+w+y,r=h+v*da+x*fa,s=i+w*da+y*fa,t=C*ea+A*ga,u=-B*ea-z*ga,a[_]=r-t,b[_]=s-u,a[ca]=r+t,b[ca]=s+u,D=h+v*fa+x*da,E=i+w*fa+y*da,F=-C*ga+A*ea,G=B*ga-z*ea,a[aa]=D+F,b[aa]=E+G,a[ba]=D-F,b[ba]=E-G,T+=d,U+=X,V+=Y,W+=Z,++$,++_,++aa,++ba,++ca},f=function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t=new Float32Array(h),u=new Float32Array(h),v=Math.sqrt(1/h);for(j=0;g>j;++j){for(m=c+j,k=0;h>k;++k)t[k]=a[m]*v,u[k]=b[m]*v,m+=g;m=c+j;var w=d*j;for(k=0;h>k;++k){n=t[0],o=u[0];var x=0;for(l=1;h>l;++l)x+=w,x>=i&&(x-=i),p=t[l],q=u[l],r=e[x],s=f[x],n+=p*r-q*s,o+=p*s+q*r;a[m]=n,b[m]=o,m+=g,w+=d}}},g=function(a,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=o[p++],v=o[p++],w=i,x=i+u*v,y=m*n;if(1==v){do a[i]=j[l],h[i]=k[l],l+=y,++i;while(i!=x)}else do g(a,h,i,j,k,l,m*u,n,o,p,q,r,s,t),l+=y,i+=v;while(i!=x);switch(i=w,u){case 2:b(a,h,i,m,q,r,v);break;case 3:c(a,h,i,m,q,r,v);break;case 4:d(a,h,i,m,q,r,v,t);break;case 5:e(a,h,i,m,q,r,v);break;default:f(a,h,i,m,q,r,v,u,s)}},h=function(a,b){var c=4,d=Math.floor(Math.sqrt(a)),e=0;do{for(;a%c;){switch(c){case 4:c=2;break;case 2:c=3;break;default:c+=2}c>d&&(c=a)}a=Math.floor(a/c),b[e++]=c,b[e++]=a}while(a>1)},i=function(a){a||(a=256),Object.defineProperty(this,"size",{configurable:!1,writable:!1,value:a}),this._twiddlesFwdRe=new Float32Array(a),this._twiddlesFwdIm=new Float32Array(a),this._twiddlesInvRe=this._twiddlesFwdRe,this._twiddlesInvIm=new Float32Array(a);for(var b=0;a>b;++b){var c=-2*Math.PI*b/a,d=Math.cos(c),e=Math.sin(c);this._twiddlesFwdRe[b]=d,this._twiddlesFwdIm[b]=e,this._twiddlesInvIm[b]=-e}this._factors=new Int32Array(64),h(a,this._factors)};i.prototype.forwardCplx=function(a,b,c,d){var e=this._twiddlesFwdRe,f=this._twiddlesFwdIm;g(a,b,0,c,d,0,1,1,this._factors,0,e,f,this.size,!1)},i.prototype.forward=function(a,b,c){this.forwardCplx(a,b,c,new Float32Array(this.size))},i.prototype.inverseCplx=function(a,b,c,d){var e=this._twiddlesInvRe,f=this._twiddlesInvIm;g(a,b,0,c,d,0,1,1,this._factors,0,e,f,this.size,!0)},i.prototype.inverse=function(a,b,c){this.inverseCplx(a,new Float32Array(this.size),b,c)},a.FFT=i}}();var Random=function(a){if(a=void 0===a?(new Date).getTime():a,"number"!=typeof a||Math.ceil(a)!=Math.floor(a))throw new TypeError("seed value must be an integer");this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_by_array([a],1)};Random.prototype.init_genrand=function(a){for(this.mt[0]=a>>>0,this.mti=1;this.mti<this.N;this.mti++){var a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&a)>>>16)<<16)+1812433253*(65535&a)+this.mti,this.mt[this.mti]>>>=0}},Random.prototype.init_by_array=function(a,b){var c,d,e;for(this.init_genrand(19650218),c=1,d=0,e=this.N>b?this.N:b;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1664525*((4294901760&f)>>>16)<<16)+1664525*(65535&f))+a[d]+d,this.mt[c]>>>=0,c++,d++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1),d>=b&&(d=0)}for(e=this.N-1;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1566083941*((4294901760&f)>>>16)<<16)+1566083941*(65535&f))-c,this.mt[c]>>>=0,c++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1)}this.mt[0]=2147483648},Random.prototype.genrand_int32=function(){var a,b=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var c;for(this.mti==this.N+1&&this.init_genrand(5489),c=0;c<this.N-this.M;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+this.M]^a>>>1^b[1&a];for(;c<this.N-1;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+(this.M-this.N)]^a>>>1^b[1&a];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^a>>>1^b[1&a],this.mti=0}return a=this.mt[this.mti++],a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^=a>>>18,a>>>0},Random.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},Random.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},Random.prototype.random=function(){return this.pythonCompatibility&&(this.skip&&this.genrand_int32(),this.skip=!0),this.genrand_int32()*(1/4294967296)},Random.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},Random.prototype.genrand_res53=function(){var a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6;return(67108864*a+b)*(1/9007199254740992)},Random.prototype.LOG4=Math.log(4),Random.prototype.SG_MAGICCONST=1+Math.log(4.5),Random.prototype.exponential=function(a){if(1!=arguments.length)throw new SyntaxError("exponential() must  be called with 'lambda' parameter");var b=this.random();return-Math.log(b)/a},Random.prototype.gamma=function(a,b){if(2!=arguments.length)throw new SyntaxError("gamma() must be called with alpha and beta parameters");if(!(a>1)){if(1==a){for(var c=this.random();1e-7>=c;)c=this.random();return-Math.log(c)*b}for(;;){var c=this.random(),d=(Math.E+a)/Math.E,e=d*c;if(1>=e)var f=Math.pow(e,1/a);else var f=-Math.log((d-e)/a);var g=this.random();if(e>1){if(g<=Math.pow(f,a-1))break}else if(g<=Math.exp(-f))break}return f*b}for(var h=Math.sqrt(2*a-1),i=a-this.LOG4,j=a+h;;){var g=this.random();if(!(1e-7>g||c>.9999999)){var k=1-this.random(),l=Math.log(g/(1-g))/h,f=a*Math.exp(l),m=g*g*k,n=i+j*l-f;if(n+this.SG_MAGICCONST-4.5*m>=0||n>=Math.log(m))return f*b}}},Random.prototype.normal=function(a,b){if(2!=arguments.length)throw new SyntaxError("normal() must be called with mu and sigma parameters");var c=this.lastNormal;if(this.lastNormal=NaN,!c){var d=2*this.random()*Math.PI,e=Math.sqrt(-2*Math.log(1-this.random()));c=Math.cos(d)*e,this.lastNormal=Math.sin(d)*e}return a+c*b},Random.prototype.pareto=function(a){if(1!=arguments.length)throw new SyntaxError("pareto() must be called with alpha parameter");var b=this.random();return 1/Math.pow(1-b,1/a)},Random.prototype.triangular=function(a,b,c){if(3!=arguments.length)throw new SyntaxError("triangular() must be called with lower, upper and mode parameters");var d=(c-a)/(b-a),e=this.random();return d>=e?a+Math.sqrt(e*(b-a)*(c-a)):b-Math.sqrt((1-e)*(b-a)*(b-c))},Random.prototype.uniform=function(a,b){if(2!=arguments.length)throw new SyntaxError("uniform() must be called with lower and upper parameters");return a+this.random()*(b-a)},Random.prototype.weibull=function(a,b){if(2!=arguments.length)throw new SyntaxError("weibull() must be called with alpha and beta parameters");var c=1-this.random();return a*Math.pow(-Math.log(c),1/b)},"undefined"==typeof window&&"undefined"!=typeof module&&module.exports&&(module.exports=Random);var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){var a=fluid.registerNamespace("jQuery");if(flock.fluid=fluid,flock.init=function(a){var b=a?{components:{audioSystem:{options:{model:a}}}}:void 0,c=flock.enviro(b);return c},flock.ALL_CHANNELS=32,flock.OUT_UGEN_ID="flocking-out",flock.PI=Math.PI,flock.TWOPI=2*Math.PI,flock.HALFPI=Math.PI/2,flock.LOG01=Math.log(.1),flock.LOG001=Math.log(.001),flock.ROOT2=Math.sqrt(2),flock.rates={AUDIO:"audio",CONTROL:"control",SCHEDULED:"scheduled",DEMAND:"demand",CONSTANT:"constant"},fluid.registerNamespace("flock.debug"),flock.debug.failHard=!0,flock.browser=function(){if("undefined"==typeof navigator)return{};var a,b,c=navigator.userAgent.toLowerCase(),d={};return a=/(chrome)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(c)||[],b={browser:a[1]||"",version:a[2]||"0"},b.browser&&(d[b.browser]=!0,d.version=b.version),d.chrome?d.webkit=!0:d.webkit&&(d.safari=!0),d},fluid.registerNamespace("flock.platform"),flock.platform.isBrowser="undefined"!=typeof window,flock.platform.hasRequire="undefined"!=typeof require,flock.platform.os=flock.platform.isBrowser?window.navigator.platform:require("os").platform(),flock.platform.isLinux=flock.platform.os.indexOf("Linux")>-1,flock.platform.isAndroid=flock.platform.isLinux&&flock.platform.os.indexOf("arm")>-1,flock.platform.isIOS="iPhone"===flock.platform.os||"iPad"===flock.platform.os||"iPod"===flock.platform.os,flock.platform.isMobile=flock.platform.isAndroid||flock.platform.isIOS,flock.platform.browser=flock.browser(),flock.platform.isWebAudio="undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext,flock.platform.audioEngine=flock.platform.isBrowser?"webAudio":"nodejs",flock.platform.browser&&void 0!==flock.platform.browser.version){var b=flock.platform.browser.version.indexOf(".");flock.platform.browser.majorVersionNumber=Number(0>b?flock.platform.browser.version:flock.platform.browser.version.substring(0,b))}flock.shim={URL:flock.platform.isBrowser?window.URL||window.webkitURL||window.msURL:void 0},flock.requireModule=function(a,b){if(flock.platform.isBrowser)return window[b||a];if(!flock.platform.hasRequire)return void 0;var c=flock.requireModule.paths[a]||a,d=require(c);return b?d[b]:d},flock.requireModule.paths={webarraymath:"../third-party/webarraymath/js/webarraymath.js",Random:"../third-party/simjs/js/random-0.26.js"},flock.noOp=function(){},flock.isIterable=function(a){var b=typeof a;return a&&void 0!==a.length&&"string"!==b&&"function"!==b},flock.hasValue=function(a,b){var c=!1;for(var d in a)if(a[d]===b){c=!0;break}return c},flock.hasTag=function(a,b){return a&&b?a.tags&&a.tags.indexOf(b)>-1:!1},flock.randomValue=function(a,b){var c=b-a;return Math.random()*c+a},flock.randomAudioValue=function(){return 2*Math.random()-1},flock.fillBuffer=function(a,b){for(var c=0;c<a.length;c++)a[c]=b(c,a);return a},flock.fillBufferWithValue=function(a,b){for(var c=0;c<a.length;c++)a[c]=b;return a},flock.generateBuffer=function(a,b){var c=new Float32Array(a);return flock.fillBuffer(c,b)},flock.generateBufferWithValue=function(a,b){var c=new Float32Array(a);return flock.fillBufferWithValue(c,b)},flock.generate=function(a,b){var c="function"==typeof b,d="number"==typeof a,e=c?d?flock.generateBuffer:flock.fillBuffer:d?flock.generateBufferWithValue:flock.fillBufferWithValue;return e(a,b)},flock.generate.silence=function(a){return new Float32Array(a)},flock.clearBuffer=function(a){for(var b=0;b<a.length;b++)a[b]=0;return a},flock.reverse=function(a){if(!a||!flock.isIterable(a)||a.length<2)return a;if("function"==typeof a.reverse)return a.reverse();for(var b,c=0,d=a.length-1;d>c;c++,d--)b=a[c],a[c]=a[d],a[d]=b;return a},flock.randomIndex=function(a){var b=a.length-1;return Math.round(Math.random()*b)},flock.arrayChoose=function(a,b){b=b||flock.randomIndex,a=fluid.makeArray(a);var c=b(a);return a[c]},flock.choose=function(a,b){var c,d;return flock.isIterable(a)?d=flock.arrayChoose(a,b):(c=flock.arrayChoose(a.keys,b),d=a[c])},flock.shuffle=function(a){for(var b=a.length-1;b>0;b-=1){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a},flock.normalize=function(a,b,c){c=c||a;var d,e,f,g=0;for(b=void 0===b?1:b,d=0;d<a.length;d++)e=Math.abs(a[d]),e>g&&(g=e);if(g>0)for(d=0;d<a.length;d++)f=a[d],c[d]=f/g*b;return c},flock.generateFourierTable=function(a,b,c,d,e){return d*=flock.TWOPI,flock.generateBuffer(a,function(a){var f,g,h,i=0;for(f=0;c>f;f++)g=e?e[f]:1,h=(f+1)*(a*b),i+=g*Math.cos(h+d);return i})},flock.generateNormalizedFourierTable=function(a,b,c,d,e){var f=flock.generateBuffer(c,function(a){return e(a+1)}),g=flock.generateFourierTable(a,b,c,d,f);return flock.normalize(g)},flock.fillTable=function(a,b){var c="number"==typeof a?a:a.length;return b(a,flock.TWOPI/c)},flock.tableGenerators={sin:function(a,b){return flock.generateBuffer(a,function(a){return Math.sin(a*b)})},tri:function(a,b){return flock.generateNormalizedFourierTable(a,b,1e3,1,function(a){return a%2===0?0:1/(a*a)})},saw:function(a,b){return flock.generateNormalizedFourierTable(a,b,10,-.25,function(a){return 1/a})},square:function(a,b){return flock.generateNormalizedFourierTable(a,b,10,-.25,function(a){return a%2===0?0:1/a})},hann:function(a){return flock.generateBuffer(a,function(b){var c=Math.sin(Math.PI*b/a);return c*c})},sinWindow:function(a){return flock.generateBuffer(a,function(b){return Math.sin(Math.PI*b/a)})}},flock.range=function(a){var b,c,d={max:Number.NEGATIVE_INFINITY,min:1/0};for(b=0;b<a.length;b++)c=a[b],c>d.max&&(d.max=c),c<d.min&&(d.min=c);return d},flock.scale=function(a){if(a){var b,c=flock.range(a),d=(c.max-c.min)/2,e=(c.max+c.min)/2;for(b=0;b<a.length;b++)a[b]=(a[b]-e)/d;return a}},flock.copyBuffer=function(a,b,c){void 0===c&&(c=a.length);var d,e,f=c-b,g=new Float32Array(f);for(d=b,e=0;c>d;d++,e++)g[e]=a[d];return g},flock.copyToBuffer=function(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;d++)b[d]=a[d]},flock.parseMidiString=function(a){if(!a||a.length<2)return NaN;a=a.toLowerCase();var b=a.charAt(1),c="#"===b||"b"===b?2:1,d=a.substring(0,c),e=Number(a.substring(c)),f=flock.midiFreq.noteNames[d],g=12*e+f;return g},flock.midiFreq=function(a,b,c,d){return b=void 0===b?440:b,c=void 0===c?69:c,d=d||12,"string"==typeof a&&(a=flock.parseMidiString(a)),b*Math.pow(2,1*(a-c)/d)},flock.midiFreq.noteNames={"b#":0,c:0,"c#":1,db:1,d:2,"d#":3,eb:3,e:4,"e#":5,f:5,"f#":6,gb:6,g:7,"g#":8,ab:8,a:9,"a#":10,bb:10,b:11,cb:11},flock.interpolate={none:function(a,b){return a%=b.length,b[0|a]},linear:function(a,b){var c=b.length;a%=c;var d=0|a,e=(d+1)%c,f=a-d,g=b[d],h=b[e];return g+f*(h-g)},hermite:function(a,b){var c=b.length,d=Math.floor(a),e=d%c,f=a-d,g=e>0?e-1:c-1,h=(e+1)%c,i=(e+2)%c,j=b[g],k=b[e],l=b[h],m=b[i],n=.5*(l-j),o=k-l,p=n+o,q=p+o+.5*(m-k),r=p+q,s=((q*f-r)*f+n)*f+k;return s}},flock.interpolate.cubic=flock.interpolate.hermite,flock.log={fail:function(a){fluid.log(fluid.logLevel.FAIL,a)},warn:function(a){fluid.log(fluid.logLevel.WARN,a)},debug:function(a){fluid.log(fluid.logLevel.INFO,a)}},flock.fail=function(a){if(flock.debug.failHard)throw new Error(a);flock.log.fail(a)},flock.pathParseError=function(a,b,c){var d="Error parsing path '"+b+"'. Segment '"+c+"' could not be resolved. Root object was: "+fluid.prettyPrintJSON(a);flock.fail(d)},flock.get=function(a,b){if(!a)return fluid.getGlobalValue(b);if(1===arguments.length&&"string"==typeof a)return fluid.getGlobalValue(a);if(b&&""!==b){var c,d=""===b?[]:String(b).split("."),e=a[d[0]];for(c=1;c<d.length;c++){if(null===e||void 0===e)return void flock.pathParseError(a,b,d[c-1]);e=e[d[c]]}return e}},flock.set=function(a,b,c){if(a&&b&&""!==b){var d,e,f=String(b).split("."),g=f.length,h=f[0];for(d=1;g>d;d++){if(a=a[h],e=typeof a,"object"!==e)return void flock.fail("Error while setting a value at path '"+b+"'. A non-container object was found at segment '"+h+"'. Value: "+a);h=f[d],void 0===a[h]&&(a[h]={})}return a[h]=c,c}},flock.invoke=function(a,b,c){var d="function"==typeof a?a:flock.get(a,b);return"function"!=typeof d?void flock.fail("Path '"+b+"' does not resolve to a function."):d.apply(null,c)},flock.input={},flock.input.shouldExpand=function(a){return flock.parse.specialInputs.indexOf(a)<0},flock.input.pathExpander=function(a){var b,c=fluid.model.parseEL(a),d="inputs",e=c.length,f=e-1,g=[];for(b=0;f>b;b++){var h=c[b],i=c[b+1];if(g.push(h),"model"===i||"options"===i){g=g.concat(c.slice(b+1,f));break}isNaN(Number(i))&&g.push(d)}return g.push(c[f]),g.join(".")},flock.input.expandPaths=function(a){var b,c,d,e={};for(b in a)c=flock.input.pathExpander(b),d=a[b],e[c]=d;return e},flock.input.expandPath=function(a){return"string"==typeof a?flock.input.pathExpander(a):flock.input.expandPaths(a)},flock.input.getValueForPath=function(a,b){b=flock.input.expandPath(b);var c=flock.get(a,b);return flock.hasTag(c,"flock.ugen.valueType")?c.inputs.value:c},flock.input.getValuesForPathArray=function(a,b){var c,d,e={};for(c=0;c<b.length;c++)d=b[c],e[d]=flock.input.get(a,d);return e},flock.input.getValuesForPathObject=function(a,b){var c;for(c in b)b[c]=flock.input.get(a,c);return b},flock.input.get=function(a,b){return"string"==typeof b?flock.input.getValueForPath(a,b):flock.isIterable(b)?flock.input.getValuesForPathArray(a,b):flock.input.getValuesForPathObject(a,b)},flock.input.resolveValue=function(a,b,c,d,e,f,g){if("string"==typeof c){var h=fluid.extractEL(c,flock.input.valueExpressionSpec);if(h){var i=flock.input.getValueForPath(a,h);return void 0===i&&flock.log.debug("The value expression '"+c+"' resolved to undefined. If this isn't expected, check to ensure that your path is valid."),i}}return flock.input.shouldExpand(e)&&g?g(c,b,d,f):c},flock.input.valueExpressionSpec={ELstyle:"${}"},flock.input.setValueForPath=function(a,b,c,d,e){b=flock.input.expandPath(b);var f=flock.get(a,b),g=b.lastIndexOf("."),h=b.slice(g+1),i=g>-1?flock.get(a,b.slice(0,b.lastIndexOf(".inputs"))):d,j=flock.input.resolveValue(a,b,c,i,h,f,e);return flock.set(a,b,j),i&&i.onInputChanged&&i.onInputChanged(h),j},flock.input.setValuesForPaths=function(a,b,c,d){var e,f,g,h={};for(e in b)f=b[e],g=flock.input.set(a,e,f,c,d),h[e]=g;return h},flock.input.set=function(a,b,c,d,e){return"string"==typeof b?flock.input.setValueForPath(a,b,c,d,e):flock.input.setValuesForPaths(a,b,d,e)},fluid.defaults("flock.audioSystem",{gradeNames:["fluid.modelComponent"],channelRange:{min:1,max:32},outputBusRange:{min:2,max:1024},inputBusRange:{min:1,max:32},model:{rates:{audio:44100,control:689.0625,scheduled:0,demand:0,constant:0},blockSize:64,numBlocks:16,chans:2,numInputBuses:2,numBuses:8,bufferSize:"@expand:flock.audioSystem.defaultBufferSize()"},modelRelay:[{target:"rates.control",singleTransform:{type:"fluid.transforms.binaryOp",left:"{that}.model.rates.audio",operator:"/",right:"{that}.model.blockSize"}},{target:"numBlocks",singleTransform:{type:"fluid.transforms.binaryOp",left:"{that}.model.bufferSize",operator:"/",right:"{that}.model.blockSize"}},{target:"chans",singleTransform:{type:"fluid.transforms.limitRange",input:"{that}.model.chans",min:"{that}.options.channelRange.min",max:"{that}.options.channelRange.max"}},{target:"numInputBuses",singleTransform:{type:"fluid.transforms.limitRange",input:"{that}.model.numInputBuses",min:"{that}.options.inputBusRange.min",max:"{that}.options.inputBusRange.max"}},{target:"numBuses",singleTransform:{type:"fluid.transforms.free",func:"flock.audioSystem.clampNumBuses",args:["{that}.model.numBuses","{that}.options.outputBusRange","{that}.model.chans"]}}]}),flock.audioSystem.clampNumBuses=function(a,b,c){return a=Math.max(a,Math.max(c,b.min)),a=Math.min(a,b.max)},flock.audioSystem.defaultBufferSize=function(){return flock.platform.isMobile?8192:flock.platform.browser.mozilla?2048:1024},fluid.defaults("flock.busManager",{gradeNames:["fluid.modelComponent"],model:{nextAvailableBus:{input:0,interconnect:0}},members:{buses:{expander:{funcName:"flock.enviro.createAudioBuffers",args:["{audioSystem}.model.numBuses","{audioSystem}.model.blockSize"]}}},invokers:{acquireNextBus:{funcName:"flock.busManager.acquireNextBus",args:["{arguments}.0","{that}.buses","{that}.applier","{that}.model","{audioSystem}.model.chans","{audioSystem}.model.numInputBuses"]},reset:{changePath:"nextAvailableBus",value:{input:0,interconnect:0}}},listeners:{"onDestroy.reset":"{that}.reset()"}}),flock.busManager.acquireNextBus=function(a,b,c,d,e,f){var g=d.nextAvailableBus[a];if(void 0===g)return void flock.fail("An invalid bus type was specified when invoking flock.busManager.acquireNextBus(). Type was: "+a);var h=g+e,i=e+f;return"interconnect"===a&&(h+=f,i=b.length),h>=i?void flock.fail("Unable to aquire a bus. There are insufficient buses available. Please use an existing bus or configure additional buses using the enviroment's numBuses and numInputBuses parameters."):(c.change("nextAvailableBus."+a,++g),h)},fluid.defaults("flock.outputManager",{gradeNames:["fluid.modelComponent"],model:{audioSettings:"{audioSystem}.model"},invokers:{start:"{that}.events.onStart.fire()",stop:"{that}.events.onStop.fire()",reset:"{that}.events.onReset.fire"},events:{onStart:"{enviro}.events.onStart",onStop:"{enviro}.events.onStop",onReset:"{enviro}.events.onReset"}}),fluid.defaults("flock.nodeListComponent",{gradeNames:"fluid.component",members:{nodeList:"@expand:flock.nodeList()"},invokers:{insert:"flock.nodeList.insert({that}.nodeList, {arguments}.0, {arguments}.1)",head:"flock.nodeList.head({that}.nodeList, {arguments}.0)",tail:"flock.nodeList.tail({that}.nodeList, {arguments}.0)",before:"flock.nodeList.before({that}.nodeList, {arguments}.0, {arguments}.1)",after:"flock.nodeList.after({that}.nodeList, {arguments}.0, {arguments}.1)",remove:"flock.nodeList.remove({that}.nodeList, {arguments}.0)",replace:"flock.nodeList.after({that}.nodeList, {arguments}.0, {arguments}.1)"}}),fluid.defaults("flock.enviro",{gradeNames:["fluid.modelComponent","flock.nodeListComponent","fluid.resolveRootSingle"],singleRootType:"flock.enviro",isGlobalSingleton:!0,members:{buffers:{},bufferSources:{}},components:{asyncScheduler:{type:"flock.scheduler.async"},audioSystem:{type:"flock.audioSystem"},busManager:{type:"flock.busManager"}},model:{isPlaying:!1},invokers:{gen:{funcName:"flock.enviro.gen",args:["{busManager}.buses","{audioSystem}.model","{that}.nodeList.nodes"]},start:"flock.enviro.start({that}.model, {that}.events.onStart.fire)",play:"{that}.start",stop:"flock.enviro.stop({that}.model, {that}.events.onStop.fire)",reset:"{that}.events.onReset.fire()",registerBuffer:"flock.enviro.registerBuffer({arguments}.0, {that}.buffers)",releaseBuffer:"flock.enviro.releaseBuffer({arguments}.0, {that}.buffers)",saveBuffer:{funcName:"flock.enviro.saveBuffer",args:["{arguments}.0","{that}.buffers","{audioSystem}"]}},events:{onStart:null,onPlay:"{that}.events.onStart",onStop:null,onReset:null},listeners:{onCreate:["flock.enviro.registerGlobalSingleton({that})"],onStart:["{that}.applier.change(isPlaying, true)"],onStop:["{that}.applier.change(isPlaying, false)"],onReset:["{that}.stop()","{asyncScheduler}.clearAll()","flock.nodeList.clearAll({that}.nodeList)","{busManager}.reset()","fluid.clear({that}.buffers)"]}}),flock.enviro.registerGlobalSingleton=function(a){a.options.isGlobalSingleton&&(flock.environment=flock.enviro.shared=a)},flock.enviro.registerBuffer=function(a,b){a.id&&(b[a.id]=a)},flock.enviro.releaseBuffer=function(a,b){if(a){var c="string"==typeof a?a:a.id;delete b[c]}},flock.enviro.saveBuffer=function(a,b,c){if("string"==typeof a&&(a={buffer:a}),"string"==typeof a.buffer){var d=a.buffer;a.buffer=b[d],a.buffer.id=d}return a.type=a.type||"wav",a.path=a.path||a.buffer.id+"."+a.type,a.format=a.format||"int16",c.bufferWriter.save(a,a.buffer)},flock.enviro.gen=function(a,b,c){flock.evaluate.clearBuses(a,b.numBuses,b.blockSize),
flock.evaluate.synths(c)},flock.enviro.start=function(a,b){a.isPlaying||b()},flock.enviro.stop=function(a,b){a.isPlaying&&b()},flock.enviro.createAudioBuffers=function(a,b){var c,d=[];for(c=0;a>c;c++)d[c]=new Float32Array(b);return d},fluid.defaults("flock.autoEnviro",{gradeNames:["fluid.component"],members:{enviro:"@expand:flock.autoEnviro.initEnvironment()"}}),flock.autoEnviro.initEnvironment=function(){return flock.environment?flock.environment:flock.init()},fluid.defaults("flock.silentEnviro",{gradeNames:"flock.enviro",listeners:{onCreate:["flock.silentEnviro.insertOutputGainNode({that})"]}}),flock.silentEnviro.insertOutputGainNode=function(a){a.audioSystem.nativeNodeManager&&a.audioSystem.nativeNodeManager.createOutputNode({node:"Gain",params:{gain:0}})},fluid.defaults("flock.node",{gradeNames:["flock.autoEnviro","fluid.modelComponent"],addToEnvironment:"tail",model:{},components:{enviro:"{flock.enviro}"},invokers:{play:{funcName:"flock.node.play",args:["{that}","{that}.enviro","{that}.addToEnvironment"]},pause:"{that}.removeFromEnvironment()",addToEnvironment:{funcName:"flock.node.addToEnvironment",args:["{that}","{arguments}.0","{that}.enviro.nodeList"]},removeFromEnvironment:{funcName:"flock.node.removeFromEnvironment",args:["{that}","{that}.enviro.nodeList"]},isPlaying:{funcName:"flock.nodeList.isNodeActive",args:["{that}.enviro.nodeList","{that}"]}},listeners:{onCreate:["{that}.addToEnvironment({that}.options.addToEnvironment)"],onDestroy:["{that}.removeFromEnvironment()"]}}),flock.node.addToEnvironment=function(a,b,c){if(void 0===b&&(b=a.options.addToEnvironment),void 0!==b&&null!==b&&b!==!1){var d=typeof b;"string"===d&&"head"===b||"tail"===b?flock.nodeList[b](c,a):"number"===d?flock.nodeList.insert(c,a,b):flock.nodeList.tail(c,a)}},flock.node.removeFromEnvironment=function(a,b){flock.nodeList.remove(b,a)},flock.node.play=function(a,b,c){if(-1===b.nodeList.nodes.indexOf(a)){var d=a.options.addToEnvironment||"tail";c(d)}b.model.isPlaying||b.play()},fluid.defaults("flock.noteTarget",{gradeNames:"fluid.component",noteChanges:{on:{"env.gate":1},off:{"env.gate":0}},invokers:{set:{funcName:"fluid.notImplemented"},noteOn:{func:"{that}.events.noteOn.fire"},noteOff:{func:"{that}.events.noteOff.fire"},noteChange:{funcName:"flock.noteTarget.change",args:["{that}","{arguments}.0","{arguments}.1"]}},events:{noteOn:null,noteOff:null},listeners:{"noteOn.handleChange":["{that}.noteChange(on, {arguments}.0)"],"noteOff.handleChange":["{that}.noteChange(off, {arguments}.0)"]}}),flock.noteTarget.change=function(b,c,d){var e=b.options.noteChanges[c],f=a.extend({},e,d);b.set(f)},fluid.defaults("flock.synth",{gradeNames:["flock.node","flock.noteTarget"],rate:flock.rates.AUDIO,addToEnvironment:!0,mergePolicy:{ugens:"nomerge"},ugens:{expander:{funcName:"flock.makeUGens",args:["{that}.options.synthDef","{that}.rate","{that}.nodeList","{that}.enviro","{that}.audioSettings"]}},members:{rate:"{that}.options.rate",audioSettings:"{that}.enviro.audioSystem.model",nodeList:"@expand:flock.nodeList()",out:"{that}.options.ugens",genFn:"@expand:fluid.getGlobalValue(flock.evaluate.ugens)"},model:{blockSize:"@expand:flock.synth.calcBlockSize({that}.rate, {that}.enviro.audioSystem.model)"},invokers:{set:{funcName:"flock.synth.set",args:["{that}","{that}.nodeList.namedNodes","{arguments}.0","{arguments}.1","{arguments}.2"]},get:{funcName:"flock.input.get",args:["{that}.nodeList.namedNodes","{arguments}.0"]},input:{funcName:"flock.synth.input",args:["{arguments}","{that}.get","{that}.set"]}}}),flock.synth.createUGenTree=function(a,b,c){return new flock.UGenTree(a,b,c)},flock.synth.calcBlockSize=function(a,b){return a===flock.rates.AUDIO?b.blockSize:1},flock.synth.set=function(a,b,c,d,e){return flock.input.set(b,c,d,void 0,function(b,c,d,f){return flock.synth.ugenValueParser(a,b,f,e)})},flock.synth.input=function(a,b,c){var d=a[0];return d?"string"==typeof d?a.length<2?b(d):c.apply(null,a):flock.isIterable(d)?b(d):c.apply(null,a):void 0},flock.synth.ugenValueParser=function(a,b,c,d){if(null===b||void 0===b)return c;var e,f,g,h=flock.parse.ugenDef(b,a.enviro,{audioSettings:a.audioSettings,buses:a.enviro.busManager.buses,buffers:a.enviro.buffers}),i=flock.isIterable(h)?h:void 0!==h?[h]:[],j=flock.isIterable(c)?c:void 0!==c?[c]:[],k=Math.min(i.length,j.length),l=d?"swapTree":"replaceTree";for(e=0;k>e;e++)f=flock.ugenNodeList[l](a.nodeList,i[e],j[e]);for(g=e;g<i.length;g++)f++,flock.ugenNodeList.insertTree(a.nodeList,i[g],f);for(g=e;g<j.length;g++)flock.ugenNodeList.removeTree(a.nodeList,j[g]);return h},fluid.defaults("flock.synth.value",{gradeNames:["flock.synth"],rate:"demand",addToEnvironment:!1,invokers:{value:{funcName:"flock.evaluate.synthValue",args:["{that}"]}}}),fluid.defaults("flock.synth.frameRate",{gradeNames:["flock.synth.value"],rate:"scheduled",fps:60,members:{audioSettings:{rates:{scheduled:"{that}.options.fps"}}}}),flock.bufferDesc=function(){throw new Error("flock.bufferDesc is not defined. Did you forget to include the buffers.js file?")}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){flock.nodeList=function(){return{nodes:[],namedNodes:{}}},flock.nodeList.insert=function(a,b,c){return 0>c&&(c=0),a.nodes.splice(c,0,b),flock.nodeList.registerNode(a,b),c},flock.nodeList.registerNode=function(a,b){var c=b.name||b.id;c&&(a.namedNodes[c]=b)},flock.nodeList.head=function(a,b){return flock.nodeList.insert(a,b,0)},flock.nodeList.before=function(a,b,c){var d=a.nodes.indexOf(c);return flock.nodeList.insert(a,b,d)},flock.nodeList.after=function(a,b,c){var d=a.nodes.indexOf(c),e=d+1;return flock.nodeList.insert(a,b,e)},flock.nodeList.tail=function(a,b){var c=a.nodes.length;return flock.nodeList.insert(a,b,c)},flock.nodeList.unregisterNode=function(a,b){var c=b.name||b.id;c&&delete a.namedNodes[c]},flock.nodeList.isNodeActive=function(a,b){var c=a.nodes.indexOf(b);return c>-1},flock.nodeList.remove=function(a,b){if(a){var c=a.nodes.indexOf(b);return c>-1&&(a.nodes.splice(c,1),flock.nodeList.unregisterNode(a,b)),c}},flock.nodeList.replace=function(a,b,c){var d=a.nodes.indexOf(c);return 0>d?flock.nodeList.tail(a,b):(a.nodes[d]=b,flock.nodeList.unregisterNode(a,c),flock.nodeList.registerNode(a,b),d)},flock.nodeList.clearAll=function(a){a.nodes.length=0;for(var b in a.namedNodes)delete a.namedNodes[b]},flock.ugenNodeList=function(){return flock.nodeList()},flock.ugenNodeList.insertTree=function(a,b,c){var d,e,f=b.inputs;for(d in f)e=f[d],flock.isUGen(e)&&(c=flock.ugenNodeList.insertTree(a,e,c),c++);return flock.nodeList.insert(a,b,c)},flock.ugenNodeList.removeTree=function(a,b){var c,d,e=b.inputs;for(c in e)d=e[c],flock.isUGen(d)&&flock.ugenNodeList.removeTree(a,d);return flock.nodeList.remove(a,b)},flock.ugenNodeList.tailTree=function(a,b){var c=a.nodes.length;return flock.ugenNodeList.insertTree(a,b,c)},flock.ugenNodeList.replaceTree=function(a,b,c){if(!c)return flock.ugenNodeList.tailTree(a,b);var d=flock.ugenNodeList.removeTree(a,c);return flock.ugenNodeList.insertTree(a,b,d),d},flock.ugenNodeList.swapTree=function(a,b,c,d){return d?(flock.ugenNodeList.reattachInputs(a,b,c,d),flock.ugenNodeList.replaceInputs(a,b,c,d)):b.inputs=c.inputs,flock.nodeList.replace(a,b,c)},flock.ugenNodeList.reattachInputs=function(a,b,c,d){for(var e in c.inputs)d.indexOf(e)<0?flock.ugenNodeList.removeTree(a,c.inputs[e]):b.inputs[e]=c.inputs[e]},flock.ugenNodeList.replaceInputs=function(a,b,c,d){for(var e in b.inputs)d.indexOf(e)<0&&flock.ugenNodeList.replaceTree(a,b.inputs[e],c.inputs[e])},flock.makeUGens=function(a,b,c,d,e){a||fluid.log(fluid.logLevel.IMPORTANT,"Warning: An empy synthDef was found while instantiating a unit generator tree.Did you forget to include a 'synthDef' option for your Synth?");var f=b===flock.rates.SCHEDULED||b===flock.rates.DEMAND;return flock.parse.synthDef(a,d,{rate:b,overrideRate:f,visitors:[flock.makeUGens.visitor(c)],buffers:d.buffers,buses:d.busManager.buses,audioSettings:e||d.audioSystem.model})},flock.makeUGens.visitor=function(a){return function(b){flock.nodeList.tail(a,b)}}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){flock.evaluate={synth:function(a){a.genFn(a.nodeList.nodes),a.out&&(a.model.value=a.out.model.value)},synthValue:function(a){return flock.evaluate.synth(a),a.model.value},synths:function(a){for(var b=0;b<a.length;b++)flock.evaluate.synth(a[b])},clearBuses:function(a,b,c){for(var d=0;b>d;d++)for(var e=a[d],f=0;c>f;f++)e[f]=0},ugens:function(a){for(var b,c=0;c<a.length;c++)b=a[c],void 0!==b.gen&&b.gen(b.model.blockSize)}}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.modelSynth",{gradeNames:"flock.synth",model:{inputs:{}},modelListeners:{inputs:[{funcName:"flock.modelSynth.updateUGens",args:["{that}.set","{that}.options.ugens","{change}"]}]},invokers:{value:"{that}.events.onEvaluate.fire()"},events:{onEvaluate:null},listeners:{onEvaluate:["{that}.genFn({that}.nodeList.nodes)",{changePath:"value",value:"{that}.out.model.value"}]}}),flock.modelSynth.updateUGens=function(a,b,c){var d={};flock.modelSynth.flattenModel("",c.value,d),a(d)},flock.modelSynth.shouldFlattenValue=function(a){return fluid.isPrimitive(a)||flock.isIterable(a)||a.ugen},flock.modelSynth.flattenModel=function(a,b,c){for(var d in b){var e=b[d],f=fluid.pathUtil.composePath(a,d.toString());flock.modelSynth.shouldFlattenValue(e)?c[f]=e:flock.modelSynth.flattenModel(f,e,c)}return c}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.synth.group",{gradeNames:["flock.node","flock.noteTarget"],methodEventMap:{onSet:"set"},members:{nodeList:"@expand:flock.nodeList()",genFn:"@expand:fluid.getGlobalValue(flock.evaluate.synths)"},invokers:{play:"{that}.events.onPlay.fire",pause:"{that}.events.onPause.fire",set:"{that}.events.onSet.fire",get:"flock.synth.group.get({arguments}, {that}.nodeList.nodes)",head:"flock.synth.group.head({arguments}.0, {that})",tail:"flock.synth.group.tail({arguments}.0, {that})",insert:"flock.synth.group.insert({arguments}.0, {arguments}.1, {that})",before:"flock.synth.group.before({arguments}.0, {arguments}.1, {that})",after:"flock.synth.group.after({arguments}.0, {arguments}.1, {that})",remove:"{that}.events.onRemove.fire",input:{funcName:"flock.synth.group.input",args:["{arguments}","{that}.get","{that}.events.onSet.fire"]}},events:{onSet:null,onGen:null,onPlay:null,onPause:null,onInsert:null,onRemove:null},listeners:{onInsert:[{funcName:"flock.synth.group.bindMethods",args:["{arguments}.0","{that}.options.methodEventMap","{that}.events","addListener"]},"flock.synth.group.removeNodeFromEnvironment({arguments}.0)"],onRemove:[{funcName:"flock.synth.group.bindMethods",args:["{arguments}.0","{that}.options.methodEventMap","{that}.events","removeListener"]},{"this":"{that}.nodeList",method:"remove",args:["{arguments}.0"]}]}}),flock.synth.group.head=function(a,b){flock.nodeList.head(b.nodeList,a),b.events.onInsert.fire(a)},flock.synth.group.tail=function(a,b){flock.nodeList.tail(b.nodeList,a),b.events.onInsert.fire(a)},flock.synth.group.insert=function(a,b,c){flock.nodeList.insert(c.nodeList,a,b),c.events.onInsert.fire(a)},flock.synth.group.before=function(a,b,c){flock.nodeList.before(c.nodeList,a,b),c.events.onInsert.fire(a)},flock.synth.group.after=function(a,b,c){flock.nodeList.after(c.nodeList,a,b),c.events.onInsert.fire(a)},flock.synth.group.removeNodeFromEnvironment=function(a){a.removeFromEnvironment()},flock.synth.group.get=function(a,b){var c=b.length-1,d=b[c];return d.get.apply(d,a)},flock.synth.group.input=function(a,b,c){var d=a.length>1?c:b;return d.apply(null,a)},flock.synth.group.bindMethods=function(a,b,c,d){for(var e in b){var f=b[e],g=a[f],h=c[e],i=h[d];i(g)}}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){var a=fluid.registerNamespace("jQuery");fluid.defaults("flock.synth.polyphonic",{gradeNames:["flock.synth.group"],maxVoices:16,amplitudeNormalizer:"static",amplitudeKey:"env.sustain",noteSpecs:"{that}.options.noteChanges",distributeOptions:{source:"{that}.options.voiceAllocatorOptions",target:"{that flock.synth.voiceAllocator}.options",removeSource:!0},voiceAllocatorOptions:{synthDef:"{polyphonic}.options.synthDef",maxVoices:"{polyphonic}.options.maxVoices",amplitudeNormalizer:"{polyphonic}.options.amplitudeNormalizer",amplitudeKey:"{polyphonic}.options.amplitudeKey",listeners:{onCreateVoice:{funcName:"flock.nodeList.tail",args:["{polyphonic}.nodeList","{arguments}.0"]}}},components:{voiceAllocator:{type:"flock.synth.voiceAllocator.lazy"}},invokers:{noteChange:{funcName:"flock.synth.polyphonic.noteChange",args:["{that}","{arguments}.0","{arguments}.1","{arguments}.2"]},createVoice:{func:"{voiceAllocator}.createVoice",args:["{that}.options","{that}.insert"]}},listeners:{"noteOn.handleChange":[{funcName:"flock.synth.polyphonic.noteOn",args:["{that}","{arguments}.0","{arguments}.1"]}],"noteOff.handleChange":[{funcName:"flock.synth.polyphonic.noteOff",args:["{that}","{arguments}.0","{arguments}.1"]}]}}),flock.synth.polyphonic.noteChange=function(b,c,d,e){var f=b.options.noteChanges[c],g=a.extend({},f,e);d.set(g)},flock.synth.polyphonic.noteOn=function(a,b,c){var d=a.voiceAllocator.getFreeVoice();return a.voiceAllocator.activeVoices[b]&&a.noteOff(b),a.voiceAllocator.activeVoices[b]=d,a.noteChange("on",d,c),d},flock.synth.polyphonic.noteOff=function(a,b,c){var d=a.voiceAllocator.activeVoices[b];return d?(a.noteChange("off",d,c),delete a.voiceAllocator.activeVoices[b],a.voiceAllocator.freeVoices.push(d),d):null},fluid.defaults("flock.synth.voiceAllocator",{gradeNames:["fluid.component"],maxVoices:16,amplitudeNormalizer:"static",amplitudeKey:"env.sustain",members:{activeVoices:{},freeVoices:[]},invokers:{createVoice:{funcName:"flock.synth.voiceAllocator.createVoice",args:["{that}.options","{that}.events.onCreateVoice.fire"]}},events:{onCreateVoice:null}}),flock.synth.voiceAllocator.createVoice=function(a,b){var c,d=flock.synth({synthDef:a.synthDef,addToEnvironment:!1}),e=a.amplitudeNormalizer,f=a.amplitudeKey;return e&&("function"==typeof e?e(d,f):"static"===e&&(c=1/a.maxVoices,d.input(f,c))),b(d),d},fluid.defaults("flock.synth.voiceAllocator.lazy",{gradeNames:["flock.synth.voiceAllocator"],invokers:{getFreeVoice:{funcName:"flock.synth.voiceAllocator.lazy.get",args:["{that}.freeVoices","{that}.activeVoices","{that}.createVoice","{that}.options.maxVoices"]}}}),flock.synth.voiceAllocator.lazy.get=function(a,b,c,d){return a.length>1?a.pop():Object.keys(b).length>d?null:c()},fluid.defaults("flock.synth.voiceAllocator.pool",{gradeNames:["flock.synth.voiceAllocator"],invokers:{getFreeVoice:"flock.synth.voiceAllocator.pool.get({that}.freeVoices)"}}),flock.synth.voiceAllocator.pool.get=function(a){return a.length>0?a.pop():void 0},flock.synth.voiceAllocator.pool.allocateVoices=function(a,b,c){for(var d=0;c>d;d++)a[d]=b()}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.band",{gradeNames:["fluid.component"],synthGrade:"flock.noteTarget",invokers:{play:{func:"{that}.events.onPlay.fire"},pause:{func:"{that}.events.onPause.fire"},set:{func:"{that}.events.onSet.fire"},getSynths:{funcName:"fluid.queryIoCSelector",args:["{that}","{that}.options.synthGrade"]}},events:{onPlay:null,onPause:null,onSet:null},distributeOptions:[{source:"{that}.options.synthListeners",removeSource:!0,target:"{that flock.synth}.options.listeners"}],synthListeners:{"{band}.events.onPlay":{func:"{that}.play"},"{band}.events.onPause":{func:"{that}.pause"},"{band}.events.onSet":{func:"{that}.set"}}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){function a(){function a(a,c){var d=function(a,b){return b(c),this},e=function(a){return a(c),this};g.value=c,g.then="reject"===a?d:e,g.resolve=g.reject=function(){throw new Error("Promise already completed")},b(a,c)}function b(a,b){var c,d;for(c=0;c<f.length;c++)d=f[c],d[a]&&d[a](b);f=null}var c=function(b){a("resolve",b),g.state="fulfilled"},d=function(b){a("reject",b),g.state="rejected"},e=function(a,b){if(f)f.push({resolve:a,reject:b});else{var c="fulfilled"===g.state?a:b;c(g.value)}return this},f=[],g={state:"pending",value:void 0,resolve:c,reject:d,then:e,safe:{then:function(a,b){return g.then(a,b),this}}};return g}fluid.defaults("flock.promise",{gradeNames:["fluid.component"],members:{promise:{expander:{funcName:"flock.promise.make"}}}}),flock.promise.make=function(){return new a},flock.bufferDesc=function(a,b,c){var d=flock.platform.isWebAudio&&a instanceof AudioBuffer?flock.bufferDesc.fromAudioBuffer:flock.isIterable(a)?flock.bufferDesc.fromChannelArray:flock.bufferDesc.expand;return d(a,b,c)},flock.bufferDesc.inferFormat=function(a,b,c){var d=a.format,e=a.data;return d.sampleRate=b||d.sampleRate||44100,d.numChannels=c||d.numChannels||a.data.channels.length,d.numSampleFrames=d.numSampleFrames||e.channels.length>0?e.channels[0].length:0,d.duration=d.numSampleFrames/d.sampleRate,a},flock.bufferDesc.fromChannelArray=function(a,b,c){a instanceof Float32Array&&(a=[a]);var d={container:{},format:{numChannels:c,sampleRate:b,numSampleFrames:a[0].length},data:{channels:a}};return flock.bufferDesc.inferFormat(d,b,c)},flock.bufferDesc.expand=function(a,b,c){if(a=a||{data:{channels:[]}},a.container=a.container||{},a.format=a.format||{},a.format.numChannels=c||a.format.numChannels||a.data.channels.length,a.data&&a.data.channels&&(1===a.format.numChannels&&1!==a.data.channels.length&&(a.data.channels=[a.data.channels]),a.format.numChannels!==a.data.channels.length))throw new Error("The specified number of channels does not match the actual channel data. numChannels was: "+a.format.numChannels+" but the sample data contains "+a.data.channels.length+" channels.");return flock.bufferDesc.inferFormat(a,b,c)},flock.bufferDesc.fromAudioBuffer=function(a){var b,c={container:{},format:{sampleRate:a.sampleRate,numChannels:a.numberOfChannels,numSampleFrames:a.length,duration:a.duration},data:{channels:[]}};for(b=0;b<a.numberOfChannels;b++)c.data.channels.push(a.getChannelData(b));return c},flock.bufferDesc.toAudioBuffer=function(a,b){for(var c=a.createBuffer(b.format.numChannels,b.format.numSampleFrames,b.format.sampleRate),d=0;d<b.format.numChannels;d++)c.copyToChannel(b.data.channels[d],d);return c},fluid.defaults("flock.bufferSource",{gradeNames:["fluid.modelComponent"],sampleRate:"{enviro}.audioSystem.model.sampleRate",model:{state:"start",src:null},components:{bufferPromise:{createOnEvent:"onRefreshPromise",type:"flock.promise",options:{listeners:{onCreate:{"this":"{that}.promise",method:"then",args:["{bufferSource}.events.afterFetch.fire","{bufferSource}.events.onError.fire"]}}}}},invokers:{get:{funcName:"flock.bufferSource.get",args:["{that}","{arguments}.0"]},set:{funcName:"flock.bufferSource.set",args:["{that}","{arguments}.0"]},error:{funcName:"flock.bufferSource.error",args:["{that}","{arguments}.0"]}},listeners:{onCreate:{funcName:"{that}.events.onRefreshPromise.fire"},onRefreshPromise:{changePath:"state",value:"start"},onFetch:{changePath:"state",value:"in-progress"},afterFetch:[{changePath:"state",value:"fetched"},{funcName:"{that}.events.onBufferUpdated.fire",args:["{arguments}.0"]}],onBufferUpdated:"{enviro}.registerBuffer({arguments}.0)",onError:{changePath:"state",value:"error"}},events:{onRefreshPromise:null,onError:null,onFetch:null,afterFetch:null,onBufferUpdated:null}}),flock.bufferSource.get=function(a,b){return"in-progress"===a.model.state||b.src===a.model.src&&!b.replace?a.bufferPromise.promise:(b.src&&("fetched"!==a.model.state&&"errored"!==a.model.state||a.model.src===b.src&&!b.replace||a.events.onRefreshPromise.fire(),"start"===a.model.state&&(a.model.src=b.src,a.events.onFetch.fire(b),flock.audio.decode({src:b.src,sampleRate:a.options.sampleRate,success:function(c){b.id&&(c.id=b.id),a.set(c)},error:a.error}))),a.bufferPromise.promise)},flock.bufferSource.set=function(a,b){var c=a.model.state;return("start"===c||"in-progress"===c)&&a.bufferPromise.promise.resolve(b),a.bufferPromise.promise},flock.bufferSource.error=function(a,b){return a.bufferPromise.promise.reject(b),a.bufferPromise.promise},fluid.defaults("flock.bufferLoader",{gradeNames:["fluid.component"],bufferDefs:[],members:{buffers:[],bufferDefs:"@expand:flock.bufferLoader.expandBufferDefs({that}.options.bufferDefs)"},components:{enviro:"{flock.enviro}"},events:{afterBuffersLoaded:null,onError:null},listeners:{"onCreate.loadBuffers":{funcName:"flock.bufferLoader.loadBuffers",args:["{that}"]},"onError.logError":{funcName:"flock.log.fail"}}}),flock.bufferLoader.idFromURL=function(a){var b=a.lastIndexOf("/"),c=b>-1?b+1:0,d=a.lastIndexOf("."),e=d>-1?d:a.length;return a.substring(c,e)},flock.bufferLoader.idsFromURLs=function(a){return fluid.transform(a,flock.bufferLoader.idFromURL)},flock.bufferLoader.expandFileSequence=function(a){a=a||[];var b,c,d,e=[];for(b=0;b<a.length;b++)c=a[b],d=flock.bufferLoader.idFromURL(c),e.push({id:d,url:c});return e},flock.bufferLoader.expandBufferDef=function(a){return"string"==typeof a&&(a={url:a}),void 0===a.id&&void 0!==a.url&&(a.id=flock.bufferLoader.idFromURL(a.url)),a},flock.bufferLoader.expandBufferDefs=function(a){return a?(a=fluid.makeArray(a),fluid.transform(a,flock.bufferLoader.expandBufferDef)):[]},flock.bufferLoader.loadBuffer=function(a,b,c){try{flock.parse.bufferForDef(a,b,c.enviro)}catch(d){c.events.onError.fire(d.message)}},flock.bufferLoader.loadBuffers=function(a){var b=1,c={setBuffer:function(d){if(a.buffers.push(d),a.buffers.length===a.options.bufferDefs.length)a.events.afterBuffersLoaded.fire(a.buffers);else if(b<a.bufferDefs.length){var e=a.bufferDefs[b];flock.bufferLoader.loadBuffer(e,c,a),b++}}};flock.bufferLoader.loadBuffer(a.bufferDefs[0],c,a)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){var a=fluid.registerNamespace("jQuery");fluid.registerNamespace("flock.parse"),flock.parse.synthDef=function(a,b,c){return a||(a=[]),flock.parse.synthDef.hasOutUGen(a)||(a=flock.parse.synthDef.makeOutUGenDef(a,c)),flock.parse.ugenForDef(a,b,c)},flock.parse.synthDef.hasOutUGen=function(a){return!flock.isIterable(a)&&(a.id===flock.OUT_UGEN_ID||"flock.ugen.out"===a.ugen||"flock.ugen.valueOut"===a.ugen)},flock.parse.synthDef.makeOutUGenDef=function(a,b){return a={id:flock.OUT_UGEN_ID,ugen:"flock.ugen.valueOut",inputs:{sources:a}},b.rate===flock.rates.AUDIO&&(a.ugen="flock.ugen.out",a.inputs.bus=0,a.inputs.expand=b.audioSettings.chans),a},flock.parse.makeUGen=function(b,c,d,e){var f=e.audioSettings.rates,g=e.audioSettings.blockSize;if(b.rate||(b.rate=flock.rates.AUDIO),!flock.hasValue(flock.rates,b.rate)&&(flock.fail("An invalid rate was specified for a unit generator. ugenDef was: "+fluid.prettyPrintJSON(b)),!flock.debug.failHard)){var h=b.rate;b.rate=flock.rates.AUDIO,flock.log.warn("Overriding invalid unit generator rate. Rate is now '"+b.rate+"'; was: "+fluid.prettyPrintJSON(h))}var i;i=b.options&&void 0!==b.options.sampleRate?b.options.sampleRate:f[b.rate],b.options=a.extend(!0,{},b.options,{sampleRate:i,rate:b.rate,audioSettings:{rates:f,blockSize:g}});var j,k=b.rate===flock.rates.AUDIO?g:1;if(flock.hasTag(b.options,"flock.ugen.multiChannelOutput")){var l=b.options.numOutputs||1;j=[];for(var m=0;l>m;m++)j.push(new Float32Array(k))}else j=new Float32Array(k);var n=fluid.copy(b.options);return n.buffers=e.buffers,n.buses=e.buses,n.enviro=d,flock.invoke(void 0,b.ugen,[c,j,n])},flock.parse.reservedWords=["id","ugen","rate","inputs","options"],flock.parse.specialInputs=["value","buffer","list","table","envelope","durations","values"],flock.parse.expandInputs=function(a){if(a.inputs)return a;var b,c={};for(b in a)-1===flock.parse.reservedWords.indexOf(b)&&(c[b]=a[b],delete a[b]);return a.inputs=c,a},flock.parse.ugenDefForConstantValue=function(a){return{ugen:"flock.ugen.value",rate:flock.rates.CONSTANT,inputs:{value:a}}},flock.parse.expandValueDef=function(a){var b=typeof a;if("number"===b)return flock.parse.ugenDefForConstantValue(a);if("object"===b)return a;throw new Error("Invalid value type found in ugen definition. UGenDef was: "+fluid.prettyPrintJSON(a))},flock.parse.rateMap={ar:flock.rates.AUDIO,kr:flock.rates.CONTROL,sr:flock.rates.SCHEDULED,dr:flock.rates.DEMAND,cr:flock.rates.CONSTANT},flock.parse.expandRate=function(a,b){return a.rate=flock.parse.rateMap[a.rate]||a.rate,b.overrideRate&&a.rate!==flock.rates.CONSTANT&&(a.rate=b.rate),a},flock.parse.ugenDef=function(a,b,c){var d=flock.isIterable(a)?flock.parse.ugensForDefs:flock.parse.ugenForDef,e=d(a,b,c);return e},flock.parse.ugenDef.mergeOptions=function(b){var c=flock.ugenDefaults(b.ugen)||{};return c=fluid.copy(c),c.options=c.ugenOptions,delete c.ugenOptions,a.extend(!0,{},c,b)},flock.parse.ugensForDefs=function(a,b,c){var d,e=[];for(d=0;d<a.length;d++)e[d]=flock.parse.ugenForDef(a[d],b,c);return e},flock.parse.ugenForDef=function(b,c,d){c=c||flock.environment,d=a.extend(!0,{audioSettings:c.audioSystem.model,buses:c.busManager.buses,buffers:c.buffers},d);var e=d,f=e.visitors,g=e.audioSettings.rates;if(b=flock.parse.expandValueDef(b),flock.isIterable(b))return flock.parse.ugensForDefs(b,c,d);b=flock.parse.expandInputs(b),flock.parse.expandRate(b,d),b=flock.parse.ugenDef.mergeOptions(b,d);var h,i=b.inputs,j={};for(h in i){var k=i[h];null!==k&&(j[h]=flock.input.shouldExpand(h,b)?flock.parse.ugenForDef(k,c,d):k)}if(!b.ugen)throw new Error("Unit generator definition lacks a 'ugen' property; can't initialize the synth graph. Value: "+fluid.prettyPrintJSON(b));var l=flock.parse.makeUGen(b,j,c,d);if(b.id&&(l.id=b.id),l.options.ugenDef=b,f)for(var m=0;m<f.length;m++)f[m](l,b,g);return l},flock.parse.expandBufferDef=function(a){return"string"==typeof a?{id:a}:flock.isIterable(a)||a.data||a.format?flock.bufferDesc(a):a},flock.parse.bufferForDef=function(a,b,c){a=flock.parse.expandBufferDef(a),a.data&&a.data.channels?(a=flock.bufferDesc(a),flock.parse.bufferForDef.resolveBuffer(a,b,c)):flock.parse.bufferForDef.resolveDef(a,b,c)},flock.parse.bufferForDef.createBufferSource=function(a){return flock.bufferSource({sampleRate:a.audioSystem.model.sampleRate})},flock.parse.bufferForDef.findSource=function(a,b){var c;return b&&a.id?(c=b.bufferSources[a.id],c||(c=flock.parse.bufferForDef.createBufferSource(b),b.bufferSources[a.id]=c)):c=flock.parse.bufferForDef.createBufferSource(b),c},flock.parse.bufferForDef.bindToPromise=function(a,b,c){var d=function(a){b.events.onBufferUpdated.addListener(d),c&&c.setBuffer(a)},e=function(a){throw!a&&b.model.src&&b.model.src.indexOf(".aif")&&(a="if this is an AIFF file, you might need to include flocking-audiofile-compatibility.js in some browsers."),new Error("Error while resolving buffer "+b.model.src+": "+a)};a.then(d,e)},flock.parse.bufferForDef.resolveDef=function(a,b,c){var d,e=flock.parse.bufferForDef.findSource(a,c);a.src=a.url||a.src,a.selector&&"undefined"!=typeof document&&(a.src=document.querySelector(a.selector).files[0]),d=e.get(a),flock.parse.bufferForDef.bindToPromise(d,e,b)},flock.parse.bufferForDef.resolveBuffer=function(a,b,c){var d=flock.parse.bufferForDef.findSource(a,c),e=d.set(a);flock.parse.bufferForDef.bindToPromise(e,d,b)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){var a="undefined"!=typeof window?window.atob:require("atob");flock.applyDeferred=function(a,b,c){a&&(c="undefined"==typeof c?0:c,setTimeout(function(){a.apply(null,b)},c))},fluid.registerNamespace("flock.net"),flock.net.readBufferFromUrl=function(a){var b=a.src,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState)if(flock.net.isXHRSuccessful(c))a.success(c.response,flock.file.parseFileExtension(b));else{if(!a.error)throw new Error(c.statusText);a.error(c.statusText)}},c.open(a.method||"GET",b,!0),c.responseType=a.responseType||"arraybuffer",c.send(a.data)},flock.net.isXHRSuccessful=function(a){return 200===a.status||0===a.responseURL.indexOf("file://")&&0===a.status&&a.response},fluid.registerNamespace("flock.file"),flock.file.mimeTypes={"audio/wav":"wav","audio/x-wav":"wav","audio/wave":"wav","audio/x-aiff":"aiff","audio/aiff":"aiff","sound/aiff":"aiff"},flock.file.typeAliases={aif:"aiff",wave:"wav"},flock.file.parseFileExtension=function(a){var b,c,d=a.lastIndexOf(".");return 0>d?void 0:(b=a.substring(d+1),b=b.toLowerCase(),c=flock.file.typeAliases[b],c||b)},flock.file.parseMIMEType=function(a){return flock.file.mimeTypes[a]},flock.file.stringToBuffer=function(a){var b,c=a.length,d=new ArrayBuffer(c),e=new Uint8Array(d);for(b=0;c>b;b++)e[b]=a.charCodeAt(b);return e.buffer},flock.file.readBufferFromDataUrl=function(b){var c=b.src,d=c.indexOf(","),e=c.substring(0,d),f=c.substring(d+1),g=e.indexOf(";base64"),h=g>-1,i=c.indexOf("data:")+5,j=h?g:d,k=c.substring(i,j);h&&(f=a(f)),flock.applyDeferred(function(){var a=flock.file.stringToBuffer(f);b.success(a,flock.file.parseMIMEType(k))})},flock.file.readBufferFromFile=function(a){var b=new FileReader;return b.onload=function(b){a.success(b.target.result,flock.file.parseFileExtension(a.src.name))},b.readAsArrayBuffer(a.src),b},fluid.registerNamespace("flock.audio"),flock.audio.loadBuffer=function(a){var b=a.src||a.url;if(b){b instanceof ArrayBuffer&&flock.applyDeferred(a.success,[b,a.type]);var c=flock.audio.loadBuffer.readerForSource(b);c(a)}},flock.audio.loadBuffer.readerForSource=function(a){return"undefined"!=typeof File&&a instanceof File?flock.file.readBufferFromFile:0===a.indexOf("data:")?flock.file.readBufferFromDataUrl:flock.net.readBufferFromUrl},flock.audio.decode=function(a){var b=a.success,c=function(c,d){var e=flock.audio.decoderStrategies,f=e[d]||e["default"];a.decoder&&(f="string"==typeof a.decoder?fluid.getGlobalValue(a.decoder):a.decoder),f({rawData:c,type:d,success:b,error:a.error,sampleRate:a.sampleRate})};a.success=c,flock.audio.loadBuffer(a)},flock.audio.decode.webAudio=function(a){var b=flock.webAudio.audioSystem.audioContextSingleton,c=function(b){var c=flock.bufferDesc.fromAudioBuffer(b);a.success(c)};b.decodeAudioData(a.rawData,c,a.error)},flock.audio.decoderStrategies={"default":flock.audio.decode.webAudio},flock.audio.registerDecoderStrategy=function(a,b){if(a)if("object"!=typeof a)"string"==typeof b&&(b=fluid.getGlobalValue(b)),flock.audio.decoderStrategies[a]=b;else for(var c in a)flock.audio.decoderStrategies[c]=a[c]}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){var a="undefined"!=typeof window?window:"undefined"!=typeof self?self:global;fluid.registerNamespace("flock.audio.convert"),flock.audio.convert.maxFloatValue=function(a){return 1-1/a.scale},flock.audio.convert.pcm={int8:{scale:128,setter:"setInt8",width:1},int16:{scale:32768,setter:"setInt16",width:2},int32:{scale:2147483648,setter:"setInt32",width:4},float32:{scale:1,setter:"setFloat32",width:4}};for(var b in flock.audio.convert.pcm){var c=flock.audio.convert.pcm[b];c.maxFloatValue=flock.audio.convert.maxFloatValue(c)}flock.audio.convert.specForPCMType=function(a){var b="string"==typeof a?flock.audio.convert.pcm[a]:a;return b||flock.fail("Flocking does not support "+a+" format PCM wave files."),b},flock.audio.convert.floatToInt=function(a,b){var c=Math.min(b.maxFloatValue,a);return c=Math.max(-1,c),c*=b.scale,c=Math.round(c)},flock.audio.convert.floatsToInts=function(b,c){if(b){for(var d="Int"+8*c.width+"Array",e=new a[d](b.length),f=0;f<b.length;f++){var g=b[f],h=flock.audio.convert.floatToInt(g,c);e[f]=h}return e}},flock.audio.convert.intToFloat=function(a,b){return a/b.scale},flock.audio.convert.intsToFloats=function(a,b){if(a){for(var c=new Float32Array(a.length),d=0;d<a.length;d++){var e=a[d],f=flock.audio.convert.intToFloat(e,b);c[d]=f}return c}}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.registerNamespace("flock.audio.encode"),flock.audio.interleave=function(a){var b,c,d=a.format.numSampleFrames,e=a.data.channels,f=a.format.numChannels,g=d*f,h=new Float32Array(g),i=0;
for(b=0;d>b;b++)for(c=0;f>c;c++)h[i]=e[c][b],i++;return h},flock.audio.encode=function(a,b,c){return b=b||"wav","wav"!==b.toLowerCase()&&flock.fail("Flocking currently only supports encoding WAVE files."),flock.audio.encode.wav(a,c)},flock.audio.encode.writeFloat32Array=function(a,b,c){for(var d=0;d<c.length;d++)b.setFloat32(a,c[d],!0),a+=4;return b},flock.audio.encode.setString=function(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))},flock.audio.encode.setBytes=function(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c[d])},flock.audio.encode.writeAsPCM=function(a,b,c,d){if("setFloat32"===a.setter&&d instanceof Float32Array)return flock.audio.encode.writeFloat32Array(b,c,d);for(var e=0;e<d.length;e++){var f=flock.audio.convert.floatToInt(d[e],a);c[a.setter](b,f,!0),b+=a.width}return c},flock.audio.encode.wav=function(a,b){b=b||flock.audio.convert.pcm.int16;var c=flock.audio.convert.specForPCMType(b),d=flock.audio.interleave(a),e=a.format.numChannels,f=a.format.sampleRate,g="setFloat32"!==c.setter,h=8,i=12,j=16,k=1,l=8,m=d.length*c.width,n=l+m,o=c.width*e,p=8*c.width;if(e>2||!g){var q=8,r=4,s=q+r;j+=s,e>2?(j+=24,k=65534):(j+=2,k=3)}var t=i+j,u=t+n,v=h+u,w=new ArrayBuffer(v),x=new DataView(w);flock.audio.encode.setString(x,0,"RIFF"),x.setUint32(4,u,!0),flock.audio.encode.setString(x,8,"WAVE"),flock.audio.encode.setString(x,12,"fmt "),x.setUint32(16,j,!0),x.setUint16(20,k,!0),x.setUint16(22,e,!0),x.setUint32(24,f,!0),x.setUint32(28,f*o,!0),x.setUint16(32,o,!0),x.setUint16(34,p,!0);var y=36;return 3===k?(x.setUint16(y,0,!0),y+=2,y=flock.audio.encode.wav.writeFactChunk(x,y,a.format.numSampleFrames)):65534===k&&(x.setUint16(y,22,!0),y+=2,y=flock.audio.encode.wav.additionalFormat(y,x,p,g),y=flock.audio.encode.wav.writeFactChunk(x,y,a.format.numSampleFrames)),flock.audio.encode.wav.writeDataChunk(c,y,x,d,m),x.buffer},flock.audio.encode.wav.subformats={pcm:new Uint8Array([1,0,0,0,0,0,16,0,128,0,0,170,0,56,155,113]),"float":new Uint8Array([3,0,0,0,0,0,16,0,128,0,0,170,0,56,155,113])},flock.audio.encode.wav.additionalFormat=function(a,b,c,d){b.setUint16(a,c,!0),a+=2,b.setUint32(a,2147483648,!0),a+=4;var e=flock.audio.encode.wav.subformats[d?"pcm":"float"];return flock.audio.encode.setBytes(b,a,e),a+=16},flock.audio.encode.wav.writeFactChunk=function(a,b,c){return flock.audio.encode.setString(a,b,"fact"),b+=4,a.setUint32(b,4,!0),b+=4,a.setUint32(b,c,!0),b+=4},flock.audio.encode.wav.writeDataChunk=function(a,b,c,d,e){flock.audio.encode.setString(c,b,"data"),b+=4,c.setUint32(b,e,!0),b+=4,flock.audio.encode.writeAsPCM(a,b,c,d)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){flock.shim={URL:"undefined"!=typeof window?window.URL||window.webkitURL||window.msURL:void 0},flock.worker=function(a){var b,c,d=typeof a;if("function"===d)a="("+a.toString()+")();";else if("string"!==d)throw new Error("A flock.worker must be initialized with a String or a Function.");return window.Blob?(c=new Blob([a],{type:"text/javascript"}),b=flock.shim.URL.createObjectURL(c)):b="data:text/javascript;base64,"+window.btoa(a),new Worker(b)},fluid.registerNamespace("flock.scheduler"),fluid.defaults("flock.scheduler.clock",{gradeNames:["fluid.component"],invokers:{end:"fluid.mustBeOverridden"},events:{tick:null},listeners:{"onDestroy.end":"{that}.end()"}}),fluid.defaults("flock.scheduler.intervalClock",{gradeNames:["flock.scheduler.clock"],members:{scheduled:{}},invokers:{schedule:{funcName:"flock.scheduler.intervalClock.schedule",args:["{arguments}.0","{that}.scheduled","{that}.events.tick.fire","{that}.events.onClear.fire"]},clear:{funcName:"flock.scheduler.intervalClock.clear",args:["{arguments}.0","{that}.scheduled","{that}.events.onClear.fire"]},clearAll:{funcName:"flock.scheduler.intervalClock.clearAll",args:["{that}.scheduled","{that}.events.onClear.fire"]},end:"{that}.clearAll"}}),flock.scheduler.intervalClock.schedule=function(a,b,c){var d=setInterval(function(){c(a)},a);b[a]=d},flock.scheduler.intervalClock.clear=function(a,b){var c=b[a];clearInterval(c),delete b[a]},flock.scheduler.intervalClock.clearAll=function(a,b){for(var c in a)flock.scheduler.intervalClock.clear(c,a,b)},fluid.defaults("flock.scheduler.scheduleClock",{gradeNames:["flock.scheduler.clock"],members:{scheduled:[]},invokers:{schedule:{funcName:"flock.scheduler.scheduleClock.schedule",args:["{arguments}.0","{that}.scheduled","{that}.events"]},clear:{funcName:"flock.scheduler.scheduleClock.clear",args:["{arguments}.0","{arguments}.1","{that}.scheduled","{that}.events.onClear.fire"]},clearAll:{funcName:"flock.scheduler.scheduleClock.clearAll",args:["{that}.scheduled","{that}.events.onClear.fire"]},end:"{that}.clearAll"}}),flock.scheduler.scheduleClock.schedule=function(a,b,c){var d;d=setTimeout(function(){clearTimeout(d),c.tick.fire(a)},a),b.push(d)},flock.scheduler.scheduleClock.clear=function(a,b,c){b=void 0===b?c.indexOf(a):b,b>-1&&(c.splice(b,1),clearTimeout(a))},flock.scheduler.scheduleClock.clearAll=function(a){for(var b=0;b<a.length;b++){var c=a[b];clearTimeout(c)}a.length=0},fluid.defaults("flock.scheduler.webWorkerClock",{gradeNames:["fluid.component"],members:{worker:{expander:{funcName:"flock.worker",args:"@expand:fluid.getGlobalValue(flock.scheduler.webWorkerClock.workerImpl)"}}},invokers:{postToWorker:{funcName:"flock.scheduler.webWorkerClock.postToWorker",args:["{arguments}.0","{arguments}.1","{that}.options.messages","{that}.worker"]},schedule:"{that}.postToWorker(schedule, {arguments}.0)",clear:"{that}.postToWorker(clear, {arguments}.0)",clearAll:"{that}.postToWorker(clearAll)",end:"{that}.postToWorker(end)"},events:{tick:null},listeners:{onCreate:{funcName:"flock.scheduler.webWorkerClock.init",args:["{that}"]},"onDestroy.clearAllScheduled":"{that}.clearAll","onDestroy.endWorker":{priority:"after:clearAllScheduled",func:"{that}.end"}},startMsg:{msg:"start",value:"{that}.options.clockType"},messages:{schedule:{msg:"schedule"},clear:{msg:"clear"},clearAll:{msg:"clearAll"},end:{msg:"end"}}}),flock.scheduler.webWorkerClock.init=function(a){a.worker.addEventListener("message",function(b){a.events.tick.fire(b.data.value)},!1),a.worker.postMessage(a.options.startMsg)},flock.scheduler.webWorkerClock.postToWorker=function(a,b,c,d){var e=c[a];void 0!==b&&(e.value=b),d.postMessage(e)},flock.scheduler.webWorkerClock.workerImpl=function(){var a=a||{};a.worker=a.worker||{},a.worker.clock=function(){var a={};return a.tick=function(a){self.postMessage({msg:"tick",value:a})},a},a.worker.intervalClock=function(){var b=a.worker.clock();return b.scheduled={},b.schedule=function(a){var c=setInterval(function(){b.tick(a)},a);b.scheduled[a]=c},b.clear=function(a){var c=b.scheduled[a];clearInterval(c),delete b.scheduled[a]},b.clearAll=function(){for(var a in b.scheduled)b.clear(a)},b},a.worker.scheduleClock=function(){var b=a.worker.clock();return b.scheduled=[],b.schedule=function(a){var c;c=setTimeout(function(){b.clear(c),b.tick(a)},a),b.scheduled.push(c)},b.clear=function(a,c){c=void 0===c?b.scheduled.indexOf(a):c,c>-1&&b.scheduled.splice(c,1),clearTimeout(a)},b.clearAll=function(){for(var a=0;a<b.scheduled.length;a++){var c=b.scheduled[a];clearTimeout(c)}b.scheduled.length=0},b},self.addEventListener("message",function(b){"start"===b.data.msg?a.clock=a.worker[b.data.value]():"end"===b.data.msg?a.clock&&(a.clock.clearAll(),self.close()):a.clock&&a.clock[b.data.msg](b.data.value)},!1)},fluid.defaults("flock.scheduler.webWorkerIntervalClock",{gradeNames:["flock.scheduler.webWorkerClock"],clockType:"intervalClock"}),fluid.defaults("flock.scheduler.webWorkerScheduleClock",{gradeNames:["flock.scheduler.webWorkerClock"],clockType:"scheduleClock"}),fluid.defaults("flock.scheduler",{gradeNames:["fluid.component"],events:{onScheduled:null,onFinished:null,onClearAll:null},listeners:{"onClearAll.clearClock":["{that}.clock.clearAll()"]}}),flock.scheduler.addListener=function(a,b,c){return b.push(a),c(a),a},flock.scheduler.removeListener=function(a,b,c){if(a){var d=b.indexOf(a);d>-1?(b.splice(d,1),c(a)):a.wrappedListener&&flock.scheduler.removeListener(a.wrappedListener,b,c)}},fluid.defaults("flock.scheduler.repeat",{gradeNames:["flock.scheduler"],members:{listeners:{}},components:{clock:{type:"flock.scheduler.webWorkerIntervalClock"}},invokers:{schedule:{funcName:"flock.scheduler.repeat.schedule",args:["{arguments}.0","{arguments}.1","{timeConverter}","{synthContext}","{that}.listeners","{that}.events.onScheduled.fire"]},clear:"{that}.events.onFinished.fire",clearAll:{funcName:"flock.scheduler.repeat.clearAll",args:["{that}.listeners","{that}.events.onFinished.fire","{that}.events.onClearAll.fire"]},clearInterval:{funcName:"flock.scheduler.repeat.clearInterval",args:["{arguments}.0","{that}.listeners","{that}.events.onFinished.fire"]},addIntervalListener:{funcName:"flock.scheduler.repeat.addIntervalListener",args:["{arguments}.0","{arguments}.1","{that}.listeners","{that}.clock.events.tick.addListener"]},removeIntervalListener:{funcName:"flock.scheduler.repeat.removeIntervalListener",args:["{arguments}.0","{arguments}.1","{that}.listeners","{that}.clock.events.tick.removeListener"]}},listeners:{onScheduled:["{that}.addIntervalListener({arguments}.0, {arguments}.1)","{that}.clock.schedule({arguments}.0)"],onFinished:["{that}.removeIntervalListener({arguments}.0, {arguments}.1)"]}}),flock.scheduler.repeat.intervalListeners=function(a,b){return b[a]},flock.scheduler.repeat.addIntervalListener=function(a,b,c,d){var e=flock.scheduler.repeat.intervalListeners(a,c);flock.scheduler.addListener(b,e,d)},flock.scheduler.repeat.removeIntervalListener=function(a,b,c,d){var e=flock.scheduler.repeat.intervalListeners(a,c);flock.scheduler.removeListener(b,e,d)},flock.scheduler.repeat.schedule=function(a,b,c,d,e,f){a=c.value(a),b=flock.scheduler.async.prepareListener(b,d);var g=flock.scheduler.repeat.wrapValueListener(a,b);return flock.scheduler.repeat.addInterval(a,e),f(a,g),g},flock.scheduler.repeat.wrapValueListener=function(a,b){var c=function(c){c===a&&b(c)};return c.wrappedListener=b,c},flock.scheduler.repeat.addInterval=function(a,b){var c=b[a];c||(c=b[a]=[])},flock.scheduler.repeat.clearAll=function(a,b,c){for(var d in a)flock.scheduler.repeat.clearInterval(d,a,b);c()},flock.scheduler.repeat.clearInterval=function(a,b,c){var d=b[a];if(d)for(var e=0;e<d.length;e++){var f=d[e];c(a,f)}},fluid.defaults("flock.scheduler.once",{gradeNames:["flock.scheduler"],members:{listeners:[]},components:{clock:{type:"flock.scheduler.webWorkerScheduleClock"}},invokers:{schedule:{funcName:"flock.scheduler.once.schedule",args:["{arguments}.0","{arguments}.1","{timeConverter}","{synthContext}","{that}.clear","{that}.events.onScheduled.fire"]},clear:"{that}.events.onFinished.fire",clearAll:{funcName:"flock.scheduler.once.clearAll",args:["{that}.listeners","{that}.events.onFinished.fire","{that}.events.onClearAll.fire"]}},listeners:{onScheduled:[{funcName:"flock.scheduler.addListener",args:["{arguments}.1","{that}.listeners","{that}.clock.events.tick.addListener"]},{func:"{that}.clock.schedule",args:["{arguments}.0"]}],onFinished:{funcName:"flock.scheduler.removeListener",args:["{arguments}.0","{that}.listeners","{that}.clock.events.tick.removeListener"]}}}),flock.scheduler.once.wrapValueListener=function(a,b,c){var d=function(e){e===a&&(b(e),c(d))};return d.wrappedListener=b,d},flock.scheduler.once.schedule=function(a,b,c,d,e,f){a=c.value(a),b=flock.scheduler.async.prepareListener(b,d);var g=flock.scheduler.once.wrapValueListener(a,b,e);return f(a,g),g},flock.scheduler.once.clearAll=function(a,b,c){for(var d=0;d<a.length;d++)b(a[d]);c()},fluid.defaults("flock.scheduler.async",{gradeNames:["fluid.component"],subSchedulerOptions:{components:{timeConverter:"{async}.timeConverter"},listeners:{"{async}.events.onClear":"{that}.clear()","{async}.events.onClearAll":"{that}.clearAll()","{async}.events.onEnd":"{that}.clock.end()"}},distributeOptions:{source:"{that}.options.subSchedulerOptions",removeSource:!0,target:"{that flock.scheduler}.options"},components:{timeConverter:{type:"flock.convert.seconds"},onceScheduler:{type:"flock.scheduler.once"},repeatScheduler:{type:"flock.scheduler.repeat"},synthContext:void 0},invokers:{repeat:{func:"{repeatScheduler}.schedule",args:["{arguments}.0","{arguments}.1"]},once:{func:"{onceScheduler}.schedule",args:["{arguments}.0","{arguments}.1"]},sequence:{funcName:"flock.scheduler.async.sequence",args:["{arguments}.0","{arguments}.1","{that}.once"]},schedule:{funcName:"flock.scheduler.async.schedule",args:["{arguments}.0","{that}"]},clear:"{that}.events.onClear.fire",clearAll:"{that}.events.onClearAll.fire",end:"{that}.events.onEnd.fire"},events:{onClear:null,onClearAll:null,onEnd:null},listeners:{onCreate:"{that}.schedule({that}.options.score)",onEnd:"{that}.clearAll"}}),flock.scheduler.async.sequence=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=c(a[e],b);d.push(f)}return d},flock.scheduler.async.schedule=function(a,b){if(a){a=flock.isIterable(a)?a:[a];for(var c=0;c<a.length;c++){var d=a[c];flock.invoke(b,d.interval,[d.time,d.change])}}},flock.scheduler.async.prepareListener=function(a,b){return"function"==typeof a?a:flock.scheduler.async.evaluateChangeSpec(a,b)},flock.scheduler.async.getTargetSynth=function(a,b){var c=a.synth;return c?"string"!=typeof c?c:fluid.get(b,c):b},flock.scheduler.async.makeSynthUpdater=function(a,b,c,d){return function(){for(var e in a){var f=a[e];c[e]=flock.evaluate.synthValue(f)}var g=flock.scheduler.async.getTargetSynth(b,d);g?g.set(c):flock.fail("A target synth named "+b.synth+" could not be found in the specified synthContext. Synth context was: "+d)}},flock.scheduler.async.evaluateChangeSpec=function(a,b){var c={},d={};for(var e in a.values){var f=a.values[e];f.synthDef?c[e]=flock.synth.value(f):d[e]=f}return flock.scheduler.async.makeSynthUpdater(c,a,d,b)},fluid.defaults("flock.scheduler.async.tempo",{gradeNames:["flock.scheduler.async"],bpm:60,components:{timeConverter:{type:"flock.convert.beats",options:{bpm:"{tempo}.options.bpm"}}}}),fluid.registerNamespace("flock.convert"),fluid.defaults("flock.convert.ms",{gradeNames:["fluid.component"],invokers:{value:"fluid.identity({arguments}.0)"}}),fluid.defaults("flock.convert.seconds",{gradeNames:["fluid.component"],invokers:{value:"flock.convert.seconds.toMillis({arguments}.0)"}}),flock.convert.seconds.toMillis=function(a){return 1e3*a},fluid.defaults("flock.convert.beats",{gradeNames:["fluid.component"],bpm:60,invokers:{value:"flock.convert.beats.toMillis({arguments}.0, {that}.options.bpm)"}}),flock.convert.beats.toMillis=function(a,b){return 0>=b?0:a/b*6e4}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.registerNamespace("flock.webAudio"),flock.webAudio.createNode=function(a,b){var c=b.args?fluid.makeArray(b.args):void 0,d="create"+b.node,e=d.indexOf("Node");e>-1&&(d=d.substring(0,e));var f=a[d].apply(a,c);return flock.webAudio.initNodeParams(a,f,b),flock.webAudio.initNodeProperties(f,b),flock.webAudio.initNodeInputs(f,b),f},flock.webAudio.setAudioParamValue=function(a,b,c,d){d=d||0;var e=a.currentTime+d;b.setValueAtTime(c,e)},flock.webAudio.initNodeParams=function(a,b,c){var d=c.params;if(b&&d){for(var e in d){var f=b[e],g=d[e];flock.webAudio.setAudioParamValue(a,f,g)}return b}},flock.webAudio.safariPropertyProhibitions=["channelCount","channelCountMode"],flock.webAudio.shouldSetProperty=function(a){return flock.platform.browser.safari?flock.webAudio.safariPropertyProhibitions.indexOf(a)<0:!0},flock.webAudio.initNodeProperties=function(a,b){var c=b.props;if(c){for(var d in c){var e=c[d];flock.webAudio.shouldSetProperty(d)&&(a[d]=e)}return a}},flock.webAudio.connectInput=function(a,b,c,d){c.connect(a,d,b)},flock.webAudio.initNodeInputs=function(a,b){var c=b.inputs;for(var d in c){var e=c[d],f=parseInt(d,10);e=fluid.makeArray(e);for(var g=0;g<e.length;g++){var h=e[g];flock.webAudio.connectInput(a,f,h)}}},fluid.defaults("flock.webAudio.node",{gradeNames:["fluid.modelComponent"],members:{node:"@expand:flock.webAudio.createNode({audioSystem}.context, {that}.options.nodeSpec)"},nodeSpec:{args:[],params:{},properties:{}}}),fluid.defaults("flock.webAudio.gain",{gradeNames:["flock.webAudio.node"],members:{node:"@expand:flock.webAudio.createNode({audioSystem}.context, {that}.options.nodeSpec)"},nodeSpec:{node:"Gain"}}),fluid.defaults("flock.webAudio.scriptProcessor",{gradeNames:["flock.webAudio.node"],nodeSpec:{node:"ScriptProcessor",args:["{audioSystem}.model.bufferSize","{audioSystem}.model.numInputBuses","{audioSystem}.model.chans"],params:{},properties:{channelCountMode:"explicit"}}}),fluid.defaults("flock.webAudio.channelMerger",{gradeNames:["flock.webAudio.node"],nodeSpec:{node:"ChannelMerger",args:["{audioSystem}.model.numInputBuses"],properties:{channelCountMode:"discrete"}}}),fluid.defaults("flock.webAudio.outputFader",{gradeNames:["fluid.component"],fadeDuration:.5,gainSpec:{node:"Gain",params:{gain:0},properties:{channelCount:"{flock.enviro}.audioSystem.model.chans",channelCountMode:"explicit"}},members:{gainNode:"@expand:flock.webAudio.outputFader.createGainNode({flock.enviro}.audioSystem.nativeNodeManager, {that}.options.gainSpec)",context:"{flock.enviro}.audioSystem.context"},invokers:{fadeIn:{funcName:"flock.webAudio.outputFader.fadeIn",args:["{that}.context","{that}.gainNode","{arguments}.0","{that}.options.fadeDuration"]},fadeTo:{funcName:"flock.webAudio.outputFader.fadeTo",args:["{that}.context","{that}.gainNode","{arguments}.0","{that}.options.fadeDuration"]}}}),flock.webAudio.outputFader.createGainNode=function(a,b){var c=a.createOutputNode(b);return c},flock.webAudio.outputFader.fade=function(a,b,c,d,e){e=e||0;var f=a.currentTime,g=f+e;flock.webAudio.setAudioParamValue(a,b.gain,c),b.gain.linearRampToValueAtTime(d,g)},flock.webAudio.outputFader.fadeTo=function(a,b,c,d){flock.webAudio.outputFader.fade(a,b,b.gain.value,c,d)},flock.webAudio.outputFader.fadeIn=function(a,b,c,d){flock.webAudio.outputFader.fade(a,b,0,c,d)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.webAudio.audioSystem",{gradeNames:["flock.audioSystem"],channelRange:{min:"@expand:flock.webAudio.audioSystem.calcMinChannels()",max:"@expand:flock.webAudio.audioSystem.calcMaxChannels({that}.context.destination)"},members:{context:"@expand:flock.webAudio.audioSystem.createContext()"},model:{rates:{audio:"{that}.context.sampleRate"}},components:{outputManager:{type:"flock.webAudio.outputManager"},nativeNodeManager:{type:"flock.webAudio.nativeNodeManager"},inputDeviceManager:{type:"flock.webAudio.inputDeviceManager"},bufferWriter:{type:"flock.webAudio.bufferWriter"}},listeners:{onCreate:["flock.webAudio.audioSystem.configureDestination({that}.context, {that}.model.chans)"]}}),flock.webAudio.audioSystem.createContext=function(){var a=flock.webAudio.audioSystem;return a.audioContextSingleton||(a.audioContextSingleton=new flock.shim.AudioContext),a.audioContextSingleton},flock.webAudio.audioSystem.calcMaxChannels=function(a){return flock.platform.browser.safari?a.channelCount:a.maxChannelCount},flock.webAudio.audioSystem.calcMinChannels=function(){return flock.platform.browser.safari?2:1},flock.webAudio.audioSystem.configureDestination=function(a,b){flock.platform.browser.safari||(a.destination.channelCount=b,a.destination.channelCountMode="explicit",a.destination.channelInterpretation="discrete")},fluid.defaults("flock.webAudio.enviroContextDistributor",{gradeNames:["fluid.component"],distributeOptions:[{target:"{/ flock.enviro > audioSystem}.options",record:{gradeNames:"flock.webAudio.audioSystem"}}]}),fluid.constructSingle([],{singleRootType:"flock.enviroContextDistributor",type:"flock.webAudio.enviroContextDistributor"})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.webAudio.bufferWriter",{gradeNames:"fluid.component",invokers:{save:"flock.webAudio.bufferWriter.saveBuffer({arguments}.0)"}}),flock.webAudio.bufferWriter.saveBuffer=function(a){try{var b=flock.audio.encode.wav(a.buffer,a.format),c=new Blob([b],{type:"audio/wav"});return flock.webAudio.bufferWriter.download(a.path,c),a.success&&a.success(b),b}catch(d){a.error?a.error(d):flock.fail("There was an error while trying to download the buffer named "+a.buffer.id+". Error: "+d)}},flock.webAudio.bufferWriter.download=function(a,b){var c=flock.shim.URL.createObjectURL(b),d=window.document.createElement("a"),e=document.createEvent("Event");d.href=c,d.download=a,e.initEvent("click",!0,!0),d.dispatchEvent(e)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.registerNamespace("flock.webAudio.chrome"),flock.webAudio.chrome.getSources=function(a){return MediaStreamTrack.getSources(function(b){var c=fluid.transform(b,function(a){return a.deviceId=a.id,a});a(c)})},flock.webAudio.mediaStreamFailure=function(){flock.fail("Media Capture and Streams are not supported on this browser.")};var a={AudioContext:window.AudioContext||window.webkitAudioContext,getUserMediaImpl:navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||flock.webAudio.mediaStreamFailure,getUserMedia:function(){flock.shim.getUserMediaImpl.apply(navigator,arguments)},getMediaDevicesImpl:navigator.getMediaDevices?navigator.getMediaDevices:"undefined"!=typeof window.MediaStreamTrack?flock.webAudio.chrome.getSources:flock.webAudio.mediaStreamFailure,getMediaDevice:function(){flock.shim.getMediaDevicesImpl.apply(navigator,arguments)}};jQuery.extend(flock.shim,a),fluid.defaults("flock.webAudio.inputDeviceManager",{gradeNames:["fluid.component"],invokers:{openAudioDevice:{funcName:"flock.webAudio.inputDeviceManager.openAudioDevice",args:["{arguments}.0","{that}.openAudioDeviceWithId","{that}.openFirstAudioDeviceWithLabel","{that}.openAudioDeviceWithConstraints"]},openAudioDeviceWithConstraints:{funcName:"flock.webAudio.inputDeviceManager.openAudioDeviceWithConstraints",args:["{audioSystem}.context","{enviro}","{nativeNodeManager}.createMediaStreamInput","{arguments}.0"]},openAudioDeviceWithId:{funcName:"flock.webAudio.inputDeviceManager.openAudioDeviceWithId",args:["{arguments}.0","{that}.openAudioDeviceWithConstraints"]},openFirstAudioDeviceWithLabel:{funcName:"flock.webAudio.inputDeviceManager.openFirstAudioDeviceWithLabel",args:["{arguments}.0","{that}.openAudioDeviceWithId"]}}}),flock.webAudio.inputDeviceManager.openAudioDevice=function(a,b,c,d){if(a){if(a.id)return b(a.id);if(a.label)return c(a.label)}return d()},flock.webAudio.inputDeviceManager.openAudioDeviceWithId=function(a,b){var c={audio:{optional:[{sourceId:a}]}};b(c)},flock.webAudio.inputDeviceManager.openFirstAudioDeviceWithLabel=function(a,b){a&&flock.shim.getMediaDevices(function(c){var d=c.filter(function(b){return b.label.toLowerCase()===a.toLowerCase()?!0:void 0});d.length>0?b(d[0].deviceId):fluid.log(fluid.logLevel.IMPORTANT,"An audio device named '"+a+"' could not be found.")})},flock.webAudio.inputDeviceManager.openAudioDeviceWithConstraints=function(a,b,c,d){function e(a){fluid.log(fluid.logLevel.IMPORTANT,"An error occurred while trying to access the user's microphone. "+a)}function f(a){c(a,g)}d=d||{audio:!0};var g=b.busManager.acquireNextBus("input");return flock.shim.getUserMedia(d,f,e),g}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.registerNamespace("flock.midi"),flock.midi.requestAccess=function(a,b,c){if(!navigator.requestMIDIAccess){var d="The Web MIDI API is not available. You may need to enable it in your browser's settings.";return fluid.log(fluid.logLevel.WARN,d),void c(d)}var e=navigator.requestMIDIAccess({sysex:a});e.then(b,c)},flock.midi.getPorts=function(a){var b={},c="function"==typeof a.inputs?flock.midi.collectPortsLegacy:flock.midi.collectPorts;return c("inputs",a,b),c("outputs",a,b),b},flock.midi.requestPorts=function(a,b){function c(b){var c=flock.midi.getPorts(b);a(c)}flock.midi.requestAccess(!1,c,b)},flock.midi.createPortViews=function(a){return fluid.transform(a,function(a){return{id:a.id,name:a.name,manufacturer:a.manufacturer,state:a.state,connection:a.connection}})},flock.midi.prettyPrintPorts=function(a){return fluid.prettyPrintJSON({inputs:flock.midi.createPortViews(a.inputs),outputs:flock.midi.createPortViews(a.outputs)})},flock.midi.logPorts=function(){function a(a){var b=flock.midi.prettyPrintPorts(a);console.log(b)}function b(a){console.log(a)}flock.midi.requestPorts(a,b)},flock.midi.collectPorts=function(a,b,c){for(var d=c[a]=c[a]||[],e=b[a].values(),f=e.next();!f.done;)d.push(f.value),f=e.next();return c},flock.midi.collectPortsLegacy=function(a,b,c){return b[a]&&(c[a]=b[a]()),c},flock.midi.read=function(a){var b,c=a[0],d=c>>4,e=15&c;switch(d){case 8:b=flock.midi.read.noteOff;break;case 9:b=a[2]>0?flock.midi.read.noteOn:flock.midi.read.noteOff;break;case 10:b=flock.midi.read.polyAftertouch;break;case 11:b=flock.midi.read.controlChange;break;case 12:b=flock.midi.read.programChange;break;case 13:b=flock.midi.read.channelAftertouch;break;case 14:b=flock.midi.read.pitchbend;break;case 15:b=flock.midi.read.system;break;default:return flock.fail("Received an unrecognized MIDI message: "+fluid.prettyPrintJSON(a))}return b(e,a)},flock.midi.read.note=function(a,b,c){return{type:a,chan:b,note:c[1],velocity:c[2]}},flock.midi.read.noteOn=function(a,b){return flock.midi.read.note("noteOn",a,b)},flock.midi.read.noteOff=function(a,b){return flock.midi.read.note("noteOff",a,b)},flock.midi.read.polyAftertouch=function(a,b){return{type:"aftertouch",chan:a,note:b[1],pressure:b[2]}},flock.midi.read.controlChange=function(a,b){return{type:"control",chan:a,number:b[1],value:b[2]}},flock.midi.read.programChange=function(a,b){return{type:"program",chan:a,program:b[1]}},flock.midi.read.channelAftertouch=function(a,b){return{type:"aftertouch",chan:a,pressure:b[1]}},flock.midi.read.twoByteValue=function(a){return a[2]<<7|a[1]},flock.midi.read.pitchbend=function(a,b){return{type:"pitchbend",chan:a,value:flock.midi.read.twoByteValue(b)}},flock.midi.read.system=function(a,b){if(1===a)return flock.midi.messageFailure("quarter frame MTC");var c;switch(a){case 0:c=flock.midi.read.sysex;break;case 2:c=flock.midi.read.songPointer;break;case 3:c=flock.midi.read.songSelect;break;case 6:c=flock.midi.read.tuneRequest;break;case 8:c=flock.midi.read.clock;break;case 10:c=flock.midi.read.start;break;case 11:c=flock.midi.read["continue"];break;case 12:c=flock.midi.read.stop;break;case 14:c=flock.midi.read.activeSense;break;case 15:c=flock.midi.read.reset;break;default:return flock.fail("Received an unrecognized MIDI system message: "+fluid.prettyPrintJSON(b))}return c(b)},flock.midi.messageFailure=function(a){flock.fail("Flocking does not currently support MIDI "+a+" messages.")},flock.midi.read.sysex=function(a){return{type:"sysex",data:a}},flock.midi.read.valueMessage=function(a,b){return{type:a,value:b}},flock.midi.read.songPointer=function(a){var b=flock.midi.read.twoByteValue(a);return flock.midi.read.valueMessage("songPointer",b)},flock.midi.read.songSelect=function(a){return flock.midi.read.valueMessage("songSelect",a[1])},flock.midi.read.tuneRequest=function(){return{type:"tuneRequest"}},flock.midi.systemRealtimeMessages=["tuneRequest","clock","start","continue","stop","activeSense","reset"],flock.midi.createSystemRealtimeMessageReaders=function(a){fluid.each(a,function(a){flock.midi.read[a]=function(){return{type:a}}})},flock.midi.createSystemRealtimeMessageReaders(flock.midi.systemRealtimeMessages),fluid.defaults("flock.midi.system",{gradeNames:["fluid.component"],sysex:!1,members:{access:void 0,ports:void 0},invokers:{requestAccess:{funcName:"flock.midi.requestAccess",args:["{that}.options.sysex","{that}.events.onAccessGranted.fire","{that}.events.onAccessError.fire"]},refreshPorts:{funcName:"flock.midi.system.refreshPorts",args:["{that}","{that}.access","{that}.events.onPortsAvailable.fire"]}},events:{onAccessGranted:null,onAccessError:null,onReady:null,onPortsAvailable:null},listeners:{onCreate:{func:"{that}.requestAccess"},onAccessGranted:["flock.midi.system.setAccess({that}, {arguments}.0)","{that}.refreshPorts()","{that}.events.onReady.fire({that}.ports)"],onAccessError:{funcName:"fluid.log",args:[fluid.logLevel.WARN,"MIDI Access Error: ","{arguments}.0"]}}}),flock.midi.system.setAccess=function(a,b){a.access=b},flock.midi.system.refreshPorts=function(a,b,c){a.ports=flock.midi.getPorts(b),c(a.ports)},fluid.defaults("flock.midi.receiver",{gradeNames:["fluid.component"],events:{raw:null,message:null,note:null,noteOn:null,noteOff:null,control:null,program:null,aftertouch:null,pitchbend:null}}),fluid.defaults("flock.midi.connection",{gradeNames:["flock.midi.receiver"],openImmediately:!1,sysex:!1,distributeOptions:{source:"{that}.options.sysex",target:"{that > system}.options.sysex"},ports:0,invokers:{sendRaw:{func:"{that}.events.onSendRaw.fire"},send:{funcName:"flock.midi.connection.send"},open:{funcName:"flock.midi.connection.bind",args:["{that}.system.ports","{that}.options.ports","{that}.events.onReady.fire","{that}.events.raw.fire","{that}.events.onSendRaw"]},close:{funcName:"flock.midi.connection.close",args:["{that}.system.ports","{that}.events.raw.fire"]}},components:{system:{type:"flock.midi.system",options:{events:{onReady:"{connection}.events.onPortsAvailable"}}}},events:{onPortsAvailable:null,onReady:null,onError:null,onSendRaw:null},listeners:{onPortsAvailable:{funcName:"flock.midi.connection.autoOpen",args:["{that}.options.openImmediately","{that}.open"]},onError:{funcName:"fluid.log",args:[fluid.logLevel.WARN,"{arguments}.0"]},raw:{funcName:"flock.midi.connection.fireEvent",args:["{arguments}.0","{that}.events"]},onDestroy:["{that}.close()"]}}),flock.midi.connection.send=function(){flock.fail("Sending MIDI messages is not currently supported.")},flock.midi.connection.autoOpen=function(a,b){a&&b()},flock.midi.findPorts=function(a,b){b=fluid.makeArray(b);var c=[];return fluid.each(b,function(b){var d=flock.midi.findPorts.portFinder(b),e=d(a);c=c.concat(e)}),c},flock.midi.findPorts.portFinder=function(a){if("number"==typeof a)return flock.midi.findPorts.byIndex(a);"string"==typeof a&&(a={name:a});var b=a.id?flock.midi.findPorts.idMatcher(a.id):a.manufacturer&&a.name?flock.midi.findPorts.bothMatcher(a.manufacturer,a.name):a.manufacturer?flock.midi.findPorts.manufacturerMatcher(a.manufacturer):flock.midi.findPorts.nameMatcher(a.name);return function(a){return a.filter(b)}},flock.midi.findPorts.byIndex=function(a){return function(b){var c=b[a];return c?[c]:[]}},flock.midi.findPorts.lowerCaseContainsMatcher=function(a){return function(b){var c;for(var d in a){var e=b[d],f=a[d];if(c="*"===f?!0:e&&e.toLowerCase().indexOf(f.toLowerCase())>-1,!c)break}return c}},flock.midi.findPorts.idMatcher=function(a){return function(b){return b.id===a}},flock.midi.findPorts.bothMatcher=function(a,b){return flock.midi.findPorts.lowerCaseContainsMatcher({manufacturer:a,name:b})},flock.midi.findPorts.manufacturerMatcher=function(a){return flock.midi.findPorts.lowerCaseContainsMatcher({manufacturer:a})},flock.midi.findPorts.nameMatcher=function(a){return flock.midi.findPorts.lowerCaseContainsMatcher({name:a})},flock.midi.findPorts.eachPortOfType=function(a,b,c){var d=fluid.makeArray(a);fluid.each(d,function(a){a.type===b&&c(a)})},flock.midi.connection.openPort=function(a,b){if(a.open){var c=a.open();b.push(c)}return b},flock.midi.connection.listen=function(a,b,c){return flock.midi.findPorts.eachPortOfType(a,"input",function(a){flock.midi.connection.openPort(a,c),a.addEventListener("midimessage",b,!1)}),c},flock.midi.connection.stopListening=function(a,b){flock.midi.findPorts.eachPortOfType(a,"input",function(a){a.close(),a.removeEventListener("midimessage",b,!1)})},flock.midi.connection.bindSender=function(a,b,c){var d=fluid.makeArray(a);return fluid.each(d,function(a){flock.midi.connection.openPort(a,c),b.addListener(a.send.bind(a))}),c},flock.midi.connection.fireReady=function(a,b){
!a||a.length<1||Promise.all(a).then(b)},flock.midi.connection.bind=function(a,b,c,d,e){b=flock.midi.connection.expandPortSpec(b);var f=flock.midi.findPorts(a.inputs,b.input),g=flock.midi.findPorts(a.outputs,b.output),h=[];f&&f.length>0?flock.midi.connection.listen(f,d,h):void 0!==b.input&&flock.midi.connection.logNoMatchedPorts("input",b),g&&g.length>0?flock.midi.connection.bindSender(g,e,h):void 0!==b.output&&flock.midi.connection.logNoMatchedPorts("output",b),flock.midi.connection.fireReady(h,c)},flock.midi.connection.close=function(a,b){flock.midi.connection.stopListening(a.inputs,b)},flock.midi.connection.logNoMatchedPorts=function(a,b){fluid.log(fluid.logLevel.WARN,"No matching "+a+" ports were found for port specification: ",b[a])},flock.midi.connection.expandPortSpec=function(a){if(void 0!==a.input||void 0!==a.output)return a;var b={input:{},output:{}};return"number"==typeof a?b.input=b.output=a:(flock.midi.connection.expandPortSpecProperty("manufacturer",a,b),flock.midi.connection.expandPortSpecProperty("name",a,b)),b},flock.midi.connection.expandPortSpecProperty=function(a,b,c){return c.input[a]=c.output[a]=b[a],c},flock.midi.connection.fireEvent=function(a,b){var c=flock.midi.read(a.data),d=c.type?b[c.type]:void 0;b.message.fire(c,a),("noteOn"===c.type||"noteOff"===c.type)&&b.note.fire(c,a),d&&d.fire(c,a)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.midi.controller",{gradeNames:["fluid.component"],members:{controlMap:{expander:{funcName:"flock.midi.controller.optimizeMIDIMap",args:["{that}.options.controlMap"]}},noteMap:{expander:{funcName:"flock.midi.controller.optimizeNoteMap",args:["{that}.options.noteMap"]}}},controlMap:{},noteMap:{},components:{synthContext:{type:"flock.band"},connection:{type:"flock.midi.connection",options:{ports:{input:"*"},openImmediately:!0}}},invokers:{mapControl:{funcName:"flock.midi.controller.mapControl",args:["{arguments}.0","{that}.synthContext","{that}.controlMap"]},mapNote:{funcName:"flock.midi.controller.mapNote",args:["{arguments}.0","{arguments}.1","{that}.synthContext","{that}.noteMap"]}},events:{control:"{that}.connection.events.control",note:"{that}.connection.events.note",noteOn:"{that}.connection.events.noteOn",noteOff:"{that}.connection.events.noteOff"},listeners:{control:"{that}.mapControl({arguments}.0)",note:"{that}.mapNote(note, {arguments}.0)",noteOn:"{that}.mapNote(noteOn, {arguments}.0)",noteOff:"{that}.mapNote(noteOff, {arguments}.0)"}}),flock.midi.controller.optimizeMIDIMap=function(a){var b=new Array(127);return fluid.each(a,function(a,c){var d=Number(c);b[d]=fluid.makeArray(a)}),b},flock.midi.controller.optimizeNoteMap=function(a){return{note:fluid.makeArray(a.note),noteOn:fluid.makeArray(a.noteOn),noteOff:fluid.makeArray(a.noteOff),velocity:fluid.makeArray(a.velocity)}},flock.midi.controller.expandControlMapSpec=function(a,b){return b.transform.id=a,b.valuePath=b.valuePath||"value",b.transform.ugen||(b.transform.ugen="flock.ugen.value"),b},flock.midi.controller.makeValueSynth=function(a,b,c){c=flock.midi.controller.expandControlMapSpec(b,c);var d=c.transform,e=c.valuePath;flock.set(d,e,a);var f=flock.synth.value({synthDef:d});return c.valuePath=b+"."+e,f},flock.midi.controller.transformValue=function(a,b){var c=b.transform,d=typeof c;return"function"===d?c(a):(b.transformSynth?b.transformSynth.set(b.valuePath,a):b.transformSynth=flock.midi.controller.makeValueSynth(a,"flock-midi-controller-in",b),b.transformSynth.value())},flock.midi.controller.setMappedValue=function(a,b,c){a=void 0!==b.value?b.value:b.transform?flock.midi.controller.transformValue(a,b):a;var d=c[b.synth]||c;d.set(b.input,a)},flock.midi.controller.mapMIDIValue=function(a,b,c){if(b&&!(b.length<1))for(var d=0;d<b.length;d++){var e=b[d];flock.midi.controller.setMappedValue(a,e,c)}},flock.midi.controller.mapControl=function(a,b,c){var d=c[a.number],e=a.value;flock.midi.controller.mapMIDIValue(e,d,b)},flock.midi.controller.mapNote=function(a,b,c,d){var e=d[a],f=b.note,g=d.velocity,h=b.velocity;flock.midi.controller.mapMIDIValue(f,e,c),flock.midi.controller.mapMIDIValue(h,g,c)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.webAudio.nativeNodeManager",{gradeNames:["fluid.component"],members:{outputNode:void 0,inputNodes:[]},components:{scriptProcessor:{createOnEvent:"onCreateScriptProcessor",type:"flock.webAudio.scriptProcessor",options:{nodeSpec:{inputs:{0:"{inputMerger}"}}}},merger:{type:"flock.webAudio.channelMerger"}},invokers:{connect:"{that}.events.onConnect.fire",disconnect:"{that}.events.onDisconnect.fire",createNode:{funcName:"flock.webAudio.createNode",args:["{audioSystem}.context","{arguments}.0"]},createInputNode:{funcName:"flock.webAudio.nativeNodeManager.createInputNode",args:["{that}","{arguments}.0","{arguments}.1"]},createMediaStreamInput:{funcName:"flock.webAudio.nativeNodeManager.createInputNode",args:["{that}",{node:"MediaStreamSource",args:["{arguments}.0"]},"{arguments}.1"]},createMediaElementInput:{funcName:"flock.webAudio.nativeNodeManager.createInputNode",args:["{that}",{node:"MediaElementSource",args:["{arguments}.0"]},"{arguments}.1"]},createOutputNode:{funcName:"flock.webAudio.nativeNodeManager.createOutputNode",args:["{that}","{arguments}.0"]},insertInput:{funcName:"flock.webAudio.nativeNodeManager.insertInput",args:["{that}","{audioSystem}.model","{enviro}","{arguments}.0","{arguments}.1"]},removeInput:{funcName:"flock.webAudio.nativeNodeManager.removeInput",args:["{arguments}.0","{that}.inputNodes"]},removeAllInputs:{funcName:"flock.webAudio.nativeNodeManager.removeAllInputs",args:"{that}.inputNodes"},insertOutput:{funcName:"flock.webAudio.nativeNodeManager.insertOutput",args:["{that}","{arguments}.0"]},removeOutput:{funcName:"flock.webAudio.nativeNodeManager.removeOutput",args:["{scriptProcessor}.node"]}},events:{onStart:"{enviro}.events.onStart",onStop:"{enviro}.events.onStop",onReset:"{enviro}.events.onReset",onCreateScriptProcessor:null,onConnect:null,onDisconnectNodes:null,onDisconnect:null},listeners:{onCreate:["{that}.events.onCreateScriptProcessor.fire()",{func:"{that}.insertOutput",args:"{scriptProcessor}.node"}],onStart:["{that}.connect()"],onConnect:[{"this":"{merger}.node",method:"connect",args:["{scriptProcessor}.node"]},{"this":"{that}.outputNode",method:"connect",args:["{audioSystem}.context.destination"]},{funcName:"flock.webAudio.nativeNodeManager.connectOutput",args:["{scriptProcessor}.node","{that}.outputNode"]}],onStop:["{that}.disconnect()"],onDisconnectNodes:[{"this":"{merger}.node",method:"disconnect",args:[0]},{"this":"{scriptProcessor}.node",method:"disconnect",args:[0]},{"this":"{that}.outputNode",method:"disconnect",args:[0]}],"onDisconnect.onDisconnectNodes":{func:"{that}.events.onDisconnectNodes.fire"},onReset:["{that}.removeAllInputs()","{that}.events.onCreateScriptProcessor.fire()"],onDestroy:["{that}.events.onDisconnectNodes.fire()","{that}.removeAllInputs()","flock.webAudio.nativeNodeManager.disconnectOutput({that})"]}}),flock.webAudio.nativeNodeManager.createInputNode=function(a,b,c){var d=a.createNode(b);return a.insertInput(d,c)},flock.webAudio.nativeNodeManager.createOutputNode=function(a,b){var c=a.createNode(b);return a.insertOutput(c)},flock.webAudio.nativeNodeManager.connectOutput=function(a,b){a!==b&&a.connect(b)},flock.webAudio.nativeNodeManager.disconnectOutput=function(a){a.outputNode&&a.outputNode.disconnect(0)},flock.webAudio.nativeNodeManager.removeAllInputs=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.disconnect(0)}a.length=0},flock.webAudio.nativeNodeManager.insertInput=function(a,b,c,d,e){var f=b.numInputBuses;if(a.inputNodes.length>=f)return void flock.fail("There are too many input nodes connected to Flocking. The maximum number of input buses is currently set to "+f+". Either remove an existing input node or increase Flockings numInputBuses option.");e=void 0===e?c.busManager.acquireNextBus("input"):e;var g=e-b.chans;return a.inputNodes.push(d),d.connect(a.merger.node,0,g),e},flock.webAudio.nativeNodeManager.removeInput=function(a,b){var c=b.indexOf(a);c>-1&&b.splice(c,1),a.disconnect(0)},flock.webAudio.nativeNodeManager.insertOutput=function(a,b){return flock.webAudio.nativeNodeManager.disconnectOutput(a),a.outputNode=b,b},flock.webAudio.nativeNodeManager.removeOutput=function(a){flock.webAudio.nativeNodeManager.insertOutput(a)}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){fluid.defaults("flock.webAudio.outputManager",{gradeNames:["flock.outputManager"],model:{isGenerating:!1,shouldInitIOS:flock.platform.isIOS,audioSettings:{}},invokers:{bindAudioProcess:{funcName:"flock.webAudio.outputManager.bindAudioProcess",args:["{enviro}.nodeList","{busManager}.buses","{nativeNodeManager}","{that}.model"]},unbindAudioProcess:{funcName:"flock.webAudio.outputManager.unbindAudioProcess",args:["{nativeNodeManager}"]}},listeners:{"{nativeNodeManager}.events.onConnect":["{that}.bindAudioProcess()"],"{nativeNodeManager}.events.onDisconnect":["{that}.unbindAudioProcess()"],onStart:[{func:"{that}.applier.change",args:["isGenerating",!0]},{priority:"last",funcName:"flock.webAudio.outputManager.iOSStart",args:["{that}","{audioSystem}.context","{nativeNodeManager}.scriptProcessor.node"]}],onStop:[{func:"{that}.applier.change",args:["isGenerating",!1]}],"onDestroy.unbindAudioProcess":"{that}.unbindAudioProcess()"}}),flock.webAudio.outputManager.bindAudioProcess=function(a,b,c,d){var e=c.scriptProcessor.node;e.model=d,e.nodeList=a,e.buses=b,e.inputNodes=c.inputNodes,e.onaudioprocess=flock.webAudio.outputManager.writeSamples},flock.webAudio.outputManager.unbindAudioProcess=function(a){a.scriptProcessor.node.onaudioprocess=void 0},flock.webAudio.outputManager.writeSamples=function(a){var b,c,d,e=this.inputNodes?this.inputNodes.length:0,f=this.nodeList.nodes,g=this.model.audioSettings,h=a.inputBuffer,i=a.outputBuffer,j=g.numBlocks,k=this.buses,l=g.numBuses,m=g.blockSize,n=g.chans,o=h.numberOfChannels;if(f.length<1)for(b=0;n>b;b++)flock.clearBuffer(i.getChannelData(b));else for(c=0;j>c;c++){var p=c*m;if(flock.evaluate.clearBuses(k,l,m),e>0)for(b=0;o>b;b++){var q=h.getChannelData(b),r=n+b,s=k[r];for(d=0;m>d;d++)s[d]=q[d+p]}for(flock.evaluate.synths(f),b=0;n>b;b++){var t=k[b],u=i.getChannelData(b);for(d=0;m>d;d++)u[d+p]=t[d]}}},flock.webAudio.outputManager.iOSStart=function(a,b,c){if(a.model.shouldInitIOS){var d=b.createBufferSource();d.connect(c),d.start(0),d.disconnect(0),a.applier.change("shouldInitIOS",!1)}}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){var a=fluid.registerNamespace("jQuery");flock.ugenDefaults=function(a,b){return 1===arguments.length?flock.ugenDefaults.store[a]:(flock.ugenDefaults.store[a]=b,b)},flock.ugenDefaults.store={},flock.isUGen=function(a){return a&&a.tags&&a.tags.indexOf("flock.ugen")>-1},flock.aliasUGen=function(b,c,d,e){var f=flock.get(b);flock.set(f,c,function(b,c,d){return d=a.extend(!0,{},e,d),f(b,c,d)}),flock.ugenDefaults(b+"."+c,d)},flock.aliasUGens=function(a,b){var c,d;for(c in b)d=b[c],flock.aliasUGen(a,c,{inputs:d.inputDefaults},d.options)},flock.krMul=function(a,b,c){var d,e=c.output[0];for(d=0;a>d;d++)b[d]=b[d]*e},flock.mul=function(a,b,c){var d,e=c.output;for(d=0;a>d;d++)b[d]=b[d]*e[d]},flock.krAdd=function(a,b,c,d){var e,f=d.output[0];for(e=0;a>e;e++)b[e]=b[e]+f},flock.add=function(a,b,c,d){var e,f=d.output;for(e=0;a>e;e++)b[e]=b[e]+f[e]},flock.krMulAdd=function(a,b,c,d){var e,f=c.output[0],g=d.output;for(e=0;a>e;e++)b[e]=b[e]*f+g[e]},flock.mulKrAdd=function(a,b,c,d){var e,f=c.output,g=d.output[0];for(e=0;a>e;e++)b[e]=b[e]*f[e]+g},flock.krMulKrAdd=function(a,b,c,d){var e,f=c.output[0],g=d.output[0];for(e=0;a>e;e++)b[e]=b[e]*f+g},flock.mulAdd=function(a,b,c,d){var e,f=c.output,g=d.output;for(e=0;a>e;e++)b[e]=b[e]*f[e]+g[e]},flock.onMulAddInputChanged=function(a){var b,c=a.inputs.mul,d=a.inputs.add;return c||d?(b=c?d?c.rate!==flock.rates.AUDIO?d.rate!==flock.rates.AUDIO?flock.krMulKrAdd:flock.krMulAdd:d.rate!==flock.rates.AUDIO?flock.mulKrAdd:flock.mulAdd:c.rate!==flock.rates.AUDIO?flock.krMul:flock.mul:d.rate!==flock.rates.AUDIO?flock.krAdd:flock.add,a.mulAddFn=b,void(a.mulAdd=function(b){a.mulAddFn(b,a.output,a.inputs.mul,a.inputs.add)})):void(a.mulAdd=a.mulAddFn=flock.noOp)},flock.ugen=function(a,b,c){c=c||{};var d={enviro:c.enviro||flock.environment,rate:c.rate||flock.rates.AUDIO,inputs:a,output:b,options:c,model:c.model||{unscaledValue:0,value:0},multiInputs:{},tags:["flock.ugen"]};return d.lastOutputIdx=d.output.length-1,d.get=function(a){return flock.input.get(d.inputs,a)},d.set=function(a,b){return flock.input.set(d.inputs,a,b,d,function(a){return null!==a&&void 0!==a?flock.parse.ugenDef(a,d.enviro,{audioSettings:d.options.audioSettings,buses:d.buses,buffers:d.buffers}):void 0})},d.input=function(a,b){return a?"string"==typeof a?arguments.length<2?d.get(a):d.set(a,b):flock.isIterable(a)?d.get(a):d.set(a,b):void 0},d.calculateStrides=function(){var a,b,c,e=d.model,f=d.options.strideInputs,g=d.inputs;if(e.strides=e.strides||{},f)for(a=0;a<f.length;a++)b=f[a],c=g[b],c?e.strides[b]=c.rate===flock.rates.AUDIO?1:0:fluid.log(fluid.logLevel.WARN,"An invalid input ('"+b+"') was found on a unit generator: "+d)},d.collectMultiInputs=function(){var a,b,c,e,f=d.options.multiInputNames,g=d.multiInputs;for(a=0;a<f.length;a++)b=f[a],c=g[b],c?c.length=0:c=g[b]=[],e=d.inputs[b],flock.ugen.collectMultiInputs(e,c)},d.onInputChanged=function(a){var b=d.options.multiInputNames;flock.onMulAddInputChanged(d),d.options.strideInputs&&d.calculateStrides(),!b||a&&!b.indexOf(a)||d.collectMultiInputs()},d.init=function(){var a,b,c,e=fluid.makeArray(d.options.tags),f=d.model,g=d.options;for(a=0;a<e.length;a++)d.tags.push(e[a]);if(b=g.audioSettings=g.audioSettings||d.enviro.audioSystem.model,f.sampleRate=g.sampleRate||b.rates[d.rate],f.nyquistRate=f.sampleRate,f.blockSize=d.rate===flock.rates.AUDIO?b.blockSize:1,f.sampleDur=1/f.sampleRate,d.interpolate=flock.interpolate.none,g.interpolation){var h=flock.interpolate[g.interpolation];h?d.interpolate=h:fluid.log(fluid.logLevel.IMPORTANT,"An invalid interpolation type of '"+g.interpolation+"' was specified. Defaulting to none.")}d.rate===flock.rates.DEMAND&&d.inputs.freq&&(c=flock.parse.ugenDefForConstantValue(1),d.inputs.freq=flock.parse.ugenDef(c,d.enviro))},d.init(),d},flock.ugen.collectMultiInputs=function(a,b){flock.isIterable(a)||(a=a=fluid.makeArray(a));for(var c=0;c<a.length;c++){var d=a[c];flock.ugen.collectChannelsForInput(d,b)}return b},flock.ugen.collectChannelsForInput=function(a,b){var c,d=flock.hasTag(a,"flock.ugen.multiChannelOutput"),e=d?a.output:[a.output];for(c=0;c<e.length;c++)b.push({rate:a.rate,output:e[c]});return b},flock.ugen.lastOutputValue=function(a,b){return b[a-1]},flock.ugen.buffer=function(a){a.onBufferInputChanged=function(b){var c=a.model,d=a.inputs;(c.bufDef!==d.buffer||"buffer"===b)&&(c.bufDef=d.buffer,flock.parse.bufferForDef(c.bufDef,a,a.enviro))},a.setBuffer=function(b){a.buffer=b,a.onBufferReady&&a.onBufferReady(b)},a.initBuffer=function(){a.buffer=a.model.bufDef=flock.bufferDesc({format:{sampleRate:a.options.audioSettings.rates.audio},data:{channels:[new Float32Array(a.output.length)]}})}},flock.ugen.value=function(a,b,c){var d=flock.ugen(a,b,c);return d.value=function(){return d.model.value},d.dynamicGen=function(a){for(var b=d.output,c=d.model,e=0;a>e;e++)b[e]=c.unscaledValue;d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,b)},d.onInputChanged=function(){var a=d.inputs,b=d.model;b.unscaledValue=a.value,"constant"!==d.rate?d.gen=d.dynamicGen:d.gen=void 0,flock.onMulAddInputChanged(d),d.dynamicGen(1)},d.onInputChanged(),d},flock.ugenDefaults("flock.ugen.value",{rate:"control",inputs:{value:1,mul:null,add:null},ugenOptions:{model:{unscaledValue:1,value:1},tags:["flock.ugen.valueType"]}}),flock.ugen.silence=function(a,b,c){var d=flock.ugen(a,b,c);return d.onInputChanged=function(){for(var a=0;a<d.output.length;a++)d.output[a]=0},d.onInputChanged(),d},flock.ugenDefaults("flock.ugen.silence",{rate:"constant"}),flock.ugen.passThrough=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs.source.output,g=d.output;for(b=0;b<f.length;b++)g[b]=c=f[b];for(;a>b;b++)g[b]=c=0;e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,g)},d.onInputChanged(),d},flock.ugenDefaults("flock.ugen.passThrough",{rate:"audio",inputs:{source:null,mul:null,add:null}}),flock.ugen.out=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j,k,l,m=d.model,n=d.multiInputs.sources,o=d.options.buses,p=d.inputs.bus.output[0],q=d.inputs.expand.output[0];if(b=n.length,c=Math.max(q,b),!(1>b)){for(e=0;c>e;e++){for(g=n[e%b],h=g.rate,i=o[p+e],j=h===flock.rates.AUDIO?1:0,k=0,f=0;a>f;f++,k+=j)l=g.output[k],i[f]=i[f]+l;d.mulAddFn(a,i,d.inputs.mul,d.inputs.add)}m.value=m.unscaledValue=l}},d.init=function(){d.sourceBuffers=[],d.onInputChanged()},d.init(),d},flock.ugenDefaults("flock.ugen.out",{rate:"audio",inputs:{sources:null,bus:0,expand:2},ugenOptions:{tags:["flock.ugen.outputType"],multiInputNames:["sources"]}}),flock.ugen.valueOut=function(a,b,c){var d=flock.ugen(a,b,c);return d.arraySourceGen=function(){var a,b=d.model,c=d.inputs.sources;for(a=0;a<c.length;a++)b.value[a]=c[a].output[0]},d.ugenSourceGen=function(){d.model.value=d.model.unscaledValue=d.inputs.sources.output[0]},d.onInputChanged=function(){var a=d.model,b=d.inputs.sources;flock.isIterable(b)?(d.gen=d.arraySourceGen,a.value=new Float32Array(b.length),a.unscaledValue=a.value):d.gen=d.ugenSourceGen},d.onInputChanged(),d},flock.ugenDefaults("flock.ugen.valueOut",{rate:"control",inputs:{sources:null},ugenOptions:{model:{unscaledValue:null,value:null},tags:["flock.ugen.outputType","flock.ugen.valueType"]}}),flock.ugen["in"]=function(a,b,c){var d=flock.ugen(a,b,c);return d.singleBusGen=function(a){var b=d.model,c=d.output;flock.ugen["in"].readBus(a,c,d.inputs.bus,d.options.buses),b.unscaledValue=flock.ugen.lastOutputValue(a,c),d.mulAdd(a),b.value=flock.ugen.lastOutputValue(a,c)},d.multiBusGen=function(a){var b,c,e,f,g=d.model,h=d.inputs.bus,i=d.options.buses,j=d.output;for(b=0;a>b;b++){for(f=0,c=0;c<h.length;c++)e=0|h[c].output[0],f+=i[e][b];j[b]=f}g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,j)},d.onInputChanged=function(){d.gen=flock.isIterable(d.inputs.bus)?d.multiBusGen:d.singleBusGen,flock.onMulAddInputChanged(d)},d.onInputChanged(),d},flock.ugen["in"].readBus=function(a,b,c,d){var e,f=0|c.output[0],g=d[f];for(e=0;a>e;e++)b[e]=g[e]},flock.ugenDefaults("flock.ugen.in",{rate:"audio",inputs:{bus:0,mul:null,add:null}}),flock.ugen.audioIn=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.output,g=d.bus;for(b=0;a>b;b++)f[b]=c=g[b];e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,f)},d.onInputChanged=function(){flock.onMulAddInputChanged(d)},d.init=function(){var a=d.enviro.audioSystem.inputDeviceManager.openAudioDevice(c);d.bus=d.options.buses[a],d.onInputChanged()},d.init(),d},flock.ugenDefaults("flock.ugen.audioIn",{rate:"audio",inputs:{mul:null,add:null}})}();